<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon shortcut" href="/favicon.ico" sizes="32x32" />
<link rel="icon" href="/favicon.svg" type="image/svg+xml" />
<link rel="icon" href="/favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)" />
<link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16" />
<link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
<link fetchpriority="low" href="/site.webmanifest" rel="manifest" />
<title>Windows BEG – C65mael</title>
  <meta name="description" content="PE文件结构 总体结构 ​​
程序在内存中是分节的，每一个节存储不同的数据，硬盘对齐(200h)，内存对齐(1000h)。因为程序在硬盘上和内存中的状态可能略有不同(以前的程序在内存中与在硬盘上，在内存中节与节之间会有一个&#34;拉伸&#34;过程，节与节之间的空隙变大(填充0)。而现在的程序则并不会。)，这样做可以:
节省硬盘空间。 实现多开(将只读的节保留，将可读可写的节多开，可以节省内存空间)。 头的大致结构如下：
结构 DOS头 标准PE头 可选PE头 节表 结构解释：
DOS头（IMAGE_DOS_HEADER）最早是为16位的DOS程序设计的，因此包含了一些与DOS相关的信息。现代的Windows可执行文件（PE格式）仍然保留了DOS头，以便在DOS环境下运行时能显示“此程序不能在DOS模式下运行”的消息。DOS头的第一个字段是WORD e_magic，通常为0x5A4D，即字符“MZ”，用于标识这是一个有效的DOS可执行文件头。另一个重要字段是DWORD e_lfanew，它保存了PE头（IMAGE_NT_HEADERS）在文件中的偏移量。程序在解析PE文件时，会从e_lfanew字段找到PE头的位置。值得注意的是，在e_lfanew和PE标识符（“PE”，即0x5045）之间的部分数据通常被认为是“垃圾数据”，这些数据在现代Windows系统中没有实际用途，只是为了保持文件结构的兼容性。
1、DOS头：	WORD e_magic *	&#34;MZ标记&#34; 用于判断是否为可执行文件.	DWORD e_lfanew; *	PE头相对于文件的偏移，用于定位标准PE头 在找到PE标识符“PE\0\0”（0x50450000）后，接下来就是（IMAGE_NT_HEADERS）NT头的内容。" /><link rel="canonical" href="http://localhost:1313/docs/windows/windows-beg/" itemprop="url" />

<meta property="og:title" content="Windows BEG" />
<meta property="og:description" content="PE文件结构
    总体结构
    ​​


程序在内存中是分节的，每一个节存储不同的数据，硬盘对齐(200h)，内存对齐(1000h)。因为程序在硬盘上和内存中的状态可能略有不同(以前的程序在内存中与在硬盘上，在内存中节与节之间会有一个&quot;拉伸&quot;过程，节与节之间的空隙变大(填充0)。而现在的程序则并不会。)，这样做可以:

节省硬盘空间。
实现多开(将只读的节保留，将可读可写的节多开，可以节省内存空间)。




头的大致结构如下：

  
      
          结构
      
  
  
      
          DOS头
      
      
          标准PE头
      
      
          可选PE头
      
      
          节表
      
  



结构解释：


DOS头（IMAGE_DOS_HEADER）最早是为16位的DOS程序设计的，因此包含了一些与DOS相关的信息。现代的Windows可执行文件（PE格式）仍然保留了DOS头，以便在DOS环境下运行时能显示“此程序不能在DOS模式下运行”的消息。DOS头的第一个字段是WORD e_magic，通常为0x5A4D，即字符“MZ”，用于标识这是一个有效的DOS可执行文件头。另一个重要字段是DWORD e_lfanew，它保存了PE头（IMAGE_NT_HEADERS）在文件中的偏移量。程序在解析PE文件时，会从e_lfanew字段找到PE头的位置。值得注意的是，在e_lfanew和PE标识符（“PE”，即0x5045）之间的部分数据通常被认为是“垃圾数据”，这些数据在现代Windows系统中没有实际用途，只是为了保持文件结构的兼容性。


	1、DOS头：										

	WORD   e_magic                *				&#34;MZ标记&#34; 用于判断是否为可执行文件.						
	DWORD  e_lfanew;              *				PE头相对于文件的偏移，用于定位标准PE头
  
    
    
  




在找到PE标识符“PE\0\0”（0x50450000）后，接下来就是（IMAGE_NT_HEADERS）NT头的内容。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/docs/windows/windows-beg/" /><meta property="article:section" content="docs" />



  <meta itemprop="name" content="Windows BEG">
  <meta itemprop="description" content="PE文件结构 总体结构 ​​
程序在内存中是分节的，每一个节存储不同的数据，硬盘对齐(200h)，内存对齐(1000h)。因为程序在硬盘上和内存中的状态可能略有不同(以前的程序在内存中与在硬盘上，在内存中节与节之间会有一个&#34;拉伸&#34;过程，节与节之间的空隙变大(填充0)。而现在的程序则并不会。)，这样做可以:
节省硬盘空间。 实现多开(将只读的节保留，将可读可写的节多开，可以节省内存空间)。 头的大致结构如下：
结构 DOS头 标准PE头 可选PE头 节表 结构解释：
DOS头（IMAGE_DOS_HEADER）最早是为16位的DOS程序设计的，因此包含了一些与DOS相关的信息。现代的Windows可执行文件（PE格式）仍然保留了DOS头，以便在DOS环境下运行时能显示“此程序不能在DOS模式下运行”的消息。DOS头的第一个字段是WORD e_magic，通常为0x5A4D，即字符“MZ”，用于标识这是一个有效的DOS可执行文件头。另一个重要字段是DWORD e_lfanew，它保存了PE头（IMAGE_NT_HEADERS）在文件中的偏移量。程序在解析PE文件时，会从e_lfanew字段找到PE头的位置。值得注意的是，在e_lfanew和PE标识符（“PE”，即0x5045）之间的部分数据通常被认为是“垃圾数据”，这些数据在现代Windows系统中没有实际用途，只是为了保持文件结构的兼容性。
1、DOS头：	WORD e_magic *	&#34;MZ标记&#34; 用于判断是否为可执行文件.	DWORD e_lfanew; *	PE头相对于文件的偏移，用于定位标准PE头 在找到PE标识符“PE\0\0”（0x50450000）后，接下来就是（IMAGE_NT_HEADERS）NT头的内容。">
  <meta itemprop="wordCount" content="3038">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Windows BEG">
  <meta name="twitter:description" content="PE文件结构 总体结构 ​​
程序在内存中是分节的，每一个节存储不同的数据，硬盘对齐(200h)，内存对齐(1000h)。因为程序在硬盘上和内存中的状态可能略有不同(以前的程序在内存中与在硬盘上，在内存中节与节之间会有一个&#34;拉伸&#34;过程，节与节之间的空隙变大(填充0)。而现在的程序则并不会。)，这样做可以:
节省硬盘空间。 实现多开(将只读的节保留，将可读可写的节多开，可以节省内存空间)。 头的大致结构如下：
结构 DOS头 标准PE头 可选PE头 节表 结构解释：
DOS头（IMAGE_DOS_HEADER）最早是为16位的DOS程序设计的，因此包含了一些与DOS相关的信息。现代的Windows可执行文件（PE格式）仍然保留了DOS头，以便在DOS环境下运行时能显示“此程序不能在DOS模式下运行”的消息。DOS头的第一个字段是WORD e_magic，通常为0x5A4D，即字符“MZ”，用于标识这是一个有效的DOS可执行文件头。另一个重要字段是DWORD e_lfanew，它保存了PE头（IMAGE_NT_HEADERS）在文件中的偏移量。程序在解析PE文件时，会从e_lfanew字段找到PE头的位置。值得注意的是，在e_lfanew和PE标识符（“PE”，即0x5045）之间的部分数据通常被认为是“垃圾数据”，这些数据在现代Windows系统中没有实际用途，只是为了保持文件结构的兼容性。
1、DOS头：	WORD e_magic *	&#34;MZ标记&#34; 用于判断是否为可执行文件.	DWORD e_lfanew; *	PE头相对于文件的偏移，用于定位标准PE头 在找到PE标识符“PE\0\0”（0x50450000）后，接下来就是（IMAGE_NT_HEADERS）NT头的内容。">

    <link href="/css/compiled/main.css" rel="stylesheet" />



  <link href="/css/custom.css" rel="stylesheet" />


  <script>
     
    const defaultTheme = 'system';

    const setDarkTheme = () => {
      document.documentElement.classList.add("dark");
      document.documentElement.style.colorScheme = "dark";
    }
    const setLightTheme = () => {
      document.documentElement.classList.remove("dark");
      document.documentElement.style.colorScheme = "light";
    }

    if ("color-theme" in localStorage) {
      localStorage.getItem("color-theme") === "dark" ? setDarkTheme() : setLightTheme();
    } else {
      defaultTheme === "dark" ? setDarkTheme() : setLightTheme();
      if (defaultTheme === "system") {
        window.matchMedia("(prefers-color-scheme: dark)").matches ? setDarkTheme() : setLightTheme();
      }
    }
  </script>

  
</head>
<body dir="ltr"><div class="nav-container hx-sticky hx-top-0 hx-z-20 hx-w-full hx-bg-transparent print:hx-hidden">
  <div class="nav-container-blur hx-pointer-events-none hx-absolute hx-z-[-1] hx-h-full hx-w-full hx-bg-white dark:hx-bg-dark hx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] contrast-more:hx-shadow-[0_0_0_1px_#000] dark:hx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:dark:hx-shadow-[0_0_0_1px_#fff]"></div>

  <nav class="hx-mx-auto hx-flex hx-items-center hx-justify-end hx-gap-2 hx-h-16 hx-px-6 hx-max-w-[90rem]">
    <a class="hx-flex hx-items-center hover:hx-opacity-75 ltr:hx-mr-auto rtl:hx-ml-auto" href="/">
        <img class="hx-mr-2 hx-block dark:hx-hidden" src="/images/logo.svg" alt="C65mael" height="20" width="20" />
        <img class="hx-mr-2 hx-hidden dark:hx-block" src="/images/logo.svg" alt="C65mael" height="20" width="20" />
        <span class="hx-mr-2 hx-font-extrabold hx-inline hx-select-none" title="C65mael">C65mael</span>
    </a><a
            title="文档"
            href="/docs"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-font-medium"
          >
            <span class="hx-text-center">文档</span>
          </a><a
            title="博客"
            href="/blog"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">博客</span>
          </a><a
            title="关于"
            href="/about"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">关于</span>
          </a><div class="search-wrapper hx-relative md:hx-w-64">
  <div class="hx-relative hx-flex hx-items-center hx-text-gray-900 contrast-more:hx-text-gray-800 dark:hx-text-gray-300 contrast-more:dark:hx-text-gray-300">
    <input
      placeholder="Search..."
      class="search-input hx-block hx-w-full hx-appearance-none hx-rounded-lg hx-px-3 hx-py-2 hx-transition-colors hx-text-base hx-leading-tight md:hx-text-sm hx-bg-black/[.05] dark:hx-bg-gray-50/10 focus:hx-bg-white dark:focus:hx-bg-dark placeholder:hx-text-gray-500 dark:placeholder:hx-text-gray-400 contrast-more:hx-border contrast-more:hx-border-current"
      type="search"
      value=""
      spellcheck="false"
    />
    <kbd
      class="hx-absolute hx-my-1.5 hx-select-none ltr:hx-right-1.5 rtl:hx-left-1.5 hx-h-5 hx-rounded hx-bg-white hx-px-1.5 hx-font-mono hx-text-[10px] hx-font-medium hx-text-gray-500 hx-border dark:hx-border-gray-100/20 dark:hx-bg-dark/50 contrast-more:hx-border-current contrast-more:hx-text-current contrast-more:dark:hx-border-current hx-items-center hx-gap-1 hx-transition-opacity hx-pointer-events-none hx-hidden sm:hx-flex"
    >
      CTRL K
    </kbd>
  </div>

  <div>
    <ul
      class="search-results hextra-scrollbar hx-hidden hx-border hx-border-gray-200 hx-bg-white hx-text-gray-100 dark:hx-border-neutral-800 dark:hx-bg-neutral-900 hx-absolute hx-top-full hx-z-20 hx-mt-2 hx-overflow-auto hx-overscroll-contain hx-rounded-xl hx-py-2.5 hx-shadow-xl hx-max-h-[min(calc(50vh-11rem-env(safe-area-inset-bottom)),400px)] md:hx-max-h-[min(calc(100vh-5rem-env(safe-area-inset-bottom)),400px)] hx-inset-x-0 ltr:md:hx-left-auto rtl:md:hx-right-auto contrast-more:hx-border contrast-more:hx-border-gray-900 contrast-more:dark:hx-border-gray-50 hx-w-screen hx-min-h-[100px] hx-max-w-[min(calc(100vw-2rem),calc(100%+20rem))]"
      style="transition: max-height 0.2s ease 0s;"
    ></ul>
  </div>
</div>

          <a class="hx-p-2 hx-text-current" target="_blank" rel="noreferrer" href="https://github.com/C65mael" title="GitHub"><svg height=24 fill="currentColor" viewBox="3 3 18 18">
  <path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path>
</svg>
<span class="hx-sr-only">GitHub</span>
          </a><button type="button" aria-label="Menu" class="hamburger-menu -hx-mr-2 hx-rounded hx-p-2 active:hx-bg-gray-400/20 md:hx-hidden"><svg height=24 fill="none" viewBox="0 0 24 24" stroke="currentColor"><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8H20"></path></g><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16H20"></path></g></svg></button>
  </nav>
</div>

  <div class='hx-mx-auto hx-flex hx-max-w-screen-xl'>
    <div class="mobile-menu-overlay [transition:background-color_1.5s_ease] hx-fixed hx-inset-0 hx-z-10 hx-bg-black/80 dark:hx-bg-black/60 hx-hidden"></div>
<aside class="sidebar-container hx-flex hx-flex-col print:hx-hidden md:hx-top-16 md:hx-shrink-0 md:hx-w-64 md:hx-self-start max-md:[transform:translate3d(0,-100%,0)] md:hx-sticky">
  
  <div class="hx-px-4 hx-pt-4 md:hx-hidden">
    <div class="search-wrapper hx-relative md:hx-w-64">
  <div class="hx-relative hx-flex hx-items-center hx-text-gray-900 contrast-more:hx-text-gray-800 dark:hx-text-gray-300 contrast-more:dark:hx-text-gray-300">
    <input
      placeholder="Search..."
      class="search-input hx-block hx-w-full hx-appearance-none hx-rounded-lg hx-px-3 hx-py-2 hx-transition-colors hx-text-base hx-leading-tight md:hx-text-sm hx-bg-black/[.05] dark:hx-bg-gray-50/10 focus:hx-bg-white dark:focus:hx-bg-dark placeholder:hx-text-gray-500 dark:placeholder:hx-text-gray-400 contrast-more:hx-border contrast-more:hx-border-current"
      type="search"
      value=""
      spellcheck="false"
    />
    <kbd
      class="hx-absolute hx-my-1.5 hx-select-none ltr:hx-right-1.5 rtl:hx-left-1.5 hx-h-5 hx-rounded hx-bg-white hx-px-1.5 hx-font-mono hx-text-[10px] hx-font-medium hx-text-gray-500 hx-border dark:hx-border-gray-100/20 dark:hx-bg-dark/50 contrast-more:hx-border-current contrast-more:hx-text-current contrast-more:dark:hx-border-current hx-items-center hx-gap-1 hx-transition-opacity hx-pointer-events-none hx-hidden sm:hx-flex"
    >
      CTRL K
    </kbd>
  </div>

  <div>
    <ul
      class="search-results hextra-scrollbar hx-hidden hx-border hx-border-gray-200 hx-bg-white hx-text-gray-100 dark:hx-border-neutral-800 dark:hx-bg-neutral-900 hx-absolute hx-top-full hx-z-20 hx-mt-2 hx-overflow-auto hx-overscroll-contain hx-rounded-xl hx-py-2.5 hx-shadow-xl hx-max-h-[min(calc(50vh-11rem-env(safe-area-inset-bottom)),400px)] md:hx-max-h-[min(calc(100vh-5rem-env(safe-area-inset-bottom)),400px)] hx-inset-x-0 ltr:md:hx-left-auto rtl:md:hx-right-auto contrast-more:hx-border contrast-more:hx-border-gray-900 contrast-more:dark:hx-border-gray-50 hx-w-screen hx-min-h-[100px] hx-max-w-[min(calc(100vw-2rem),calc(100%+20rem))]"
      style="transition: max-height 0.2s ease 0s;"
    ></ul>
  </div>
</div>

  </div>
  <div class="hextra-scrollbar hx-overflow-y-auto hx-overflow-x-hidden hx-p-4 hx-grow md:hx-h-[calc(100vh-var(--navbar-height)-var(--menu-height))]">
    <ul class="hx-flex hx-flex-col hx-gap-1 md:hx-hidden">
      
      
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/about/"
    
  >About
    </a></li>
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/blog/"
    
  >Blog
    </a></li>
          <li class="open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/"
    
  >Docs
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/crack/"
    
  >Crack
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a>
              <div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/crack/crack/"
    
  >Crack
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/crack/crackext/"
    
  >CrackEXT
    </a>
              
            </li></ul>
      </div>
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/"
    
  >Homework
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a>
              <div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/crack-homework/"
    
  >Crack-homework
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/homework/"
    
  >Homework
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/homeworkbas/"
    
  >HomeworkBAS
    </a>
              
            </li></ul>
      </div>
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/"
    
  >Remaining
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a>
              <div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/ai/"
    
  >AI
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/app/"
    
  >APP
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/apts/"
    
  >APTs
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/bypass/"
    
  >Bypass
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/itemlearn/"
    
  >ItemLearn
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/lab/"
    
  >Lab
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/obfu/"
    
  >Obfu
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/program-analysis/"
    
  >Program Analysis
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/web/"
    
  >Web
    </a>
              
            </li></ul>
      </div>
            </li><li class="hx-flex hx-flex-col open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/windows/"
    
  >Windows
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a>
              <div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/windows/windows-bas/"
    
  >Windows BAS
    </a>
              
            </li><li class="hx-flex hx-flex-col open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      sidebar-active-item hx-bg-primary-100 hx-font-semibold hx-text-primary-800 contrast-more:hx-border contrast-more:hx-border-primary-500 dark:hx-bg-primary-400/10 dark:hx-text-primary-600 contrast-more:dark:hx-border-primary-500"
    href="/docs/windows/windows-beg/"
    
  >Windows BEG
    </a>
  
    <ul class='hx-flex hx-flex-col hx-gap-1 hx-relative before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] dark:before:hx-bg-neutral-800 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-pr-3 rtl:before:hx-right-0 ltr:hx-ml-3 rtl:hx-mr-3'><li>
              <a
                href="#"
                class="hx-flex hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [word-break:break-word] hx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:hx-border hx-gap-2 before:hx-opacity-25 before:hx-content-['#'] hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:hx-text-gray-900 contrast-more:dark:hx-text-gray-50 contrast-more:hx-border-transparent contrast-more:hover:hx-border-gray-900 contrast-more:dark:hover:hx-border-gray-50"
              ></a>
            </li>
          </ul>
  
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/windows/windows-ext/"
    
  >Windows EXT
    </a>
              
            </li></ul>
      </div>
            </li></ul>
      </div></li>
    </ul>

    <ul class="hx-flex hx-flex-col hx-gap-1 max-md:hx-hidden">
        
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/crack/"
    
  >Crack
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/crack/crack/"
    
  >Crack
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/crack/crackext/"
    
  >CrackEXT
    </a>
              
            </li></ul>
      </div></li>
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/"
    
  >Homework
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/crack-homework/"
    
  >Crack-homework
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/homework/"
    
  >Homework
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/homework/homeworkbas/"
    
  >HomeworkBAS
    </a>
              
            </li></ul>
      </div></li>
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/"
    
  >Remaining
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/ai/"
    
  >AI
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/app/"
    
  >APP
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/apts/"
    
  >APTs
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/bypass/"
    
  >Bypass
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/itemlearn/"
    
  >ItemLearn
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/lab/"
    
  >Lab
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/obfu/"
    
  >Obfu
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/program-analysis/"
    
  >Program Analysis
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/remaining/web/"
    
  >Web
    </a>
              
            </li></ul>
      </div></li>
          <li class="open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/windows/"
    
  >Windows
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/windows/windows-bas/"
    
  >Windows BAS
    </a>
              
            </li><li class="hx-flex hx-flex-col open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      sidebar-active-item hx-bg-primary-100 hx-font-semibold hx-text-primary-800 contrast-more:hx-border contrast-more:hx-border-primary-500 dark:hx-bg-primary-400/10 dark:hx-text-primary-600 contrast-more:dark:hx-border-primary-500"
    href="/docs/windows/windows-beg/"
    
  >Windows BEG
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/docs/windows/windows-ext/"
    
  >Windows EXT
    </a>
              
            </li></ul>
      </div></li>
        
      </ul>
    </div>
  
  
    <div class="  hx-sticky hx-bottom-0 hx-bg-white dark:hx-bg-dark hx-mx-4 hx-py-4 hx-shadow-[0_-12px_16px_#fff] hx-flex hx-items-center hx-gap-2 dark:hx-border-neutral-800 dark:hx-shadow-[0_-12px_16px_#111] contrast-more:hx-border-neutral-400 contrast-more:hx-shadow-none contrast-more:dark:hx-shadow-none hx-border-t" data-toggle-animation="show"><div class="hx-flex hx-grow hx-flex-col"><button
  title="Change theme"
  data-theme="light"
  class="theme-toggle hx-group hx-h-7 hx-rounded-md hx-px-2 hx-text-left hx-text-xs hx-font-medium hx-text-gray-600 hx-transition-colors dark:hx-text-gray-400 hover:hx-bg-gray-100 hover:hx-text-gray-900 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50"
  type="button"
  aria-label="Change theme"
>
  <div class="hx-flex hx-items-center hx-gap-2 hx-capitalize"><svg height=12 class="group-data-[theme=light]:hx-hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span class="group-data-[theme=light]:hx-hidden">Light</span><svg height=12 class="group-data-[theme=dark]:hx-hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg><span class="group-data-[theme=dark]:hx-hidden">Dark</span></div>
</button>
</div></div></aside>
    
<nav class="hextra-toc hx-order-last hx-hidden hx-w-64 hx-shrink-0 xl:hx-block print:hx-hidden hx-px-4" aria-label="table of contents">
    <div class="hextra-scrollbar hx-sticky hx-top-16 hx-overflow-y-auto hx-pr-4 hx-pt-6 hx-text-sm [hyphens:auto] hx-max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] ltr:hx--mr-4 rtl:hx--ml-4"><p class="hx-mb-4 hx-font-semibold hx-tracking-tight">On this page</p><ul>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#pe%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84">PE文件结构
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%80%bb%e4%bd%93%e7%bb%93%e6%9e%84">总体结构
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#rva%e4%b8%8efoa%e7%9a%84%e8%bd%ac%e6%8d%a2">‍RVA与FOA的转换
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%ae%9e%e9%aa%8c%e5%9c%a8%e7%bc%96%e8%af%91%e5%a5%bd%e7%9a%84%e7%a8%8b%e5%ba%8f%e6%89%a7%e8%a1%8c%e5%89%8d%e5%bc%b9%e4%b8%aa%e7%aa%97%e5%8f%a3">实验：在编译好的程序执行前弹个窗口
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%89%a9%e5%a4%a7%e8%8a%82">扩大节
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%96%b0%e5%a2%9e%e8%8a%82">新增节
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e5%ba%93-%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5%e5%ba%93">静态链接库-动态链接库
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%af%bc%e5%87%ba%e8%a1%a8">导出表
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%87%8d%e5%ae%9a%e4%bd%8d%e8%a1%a8">重定位表
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%a7%bb%e5%8a%a8%e5%af%bc%e5%87%ba%e8%a1%a8%e9%87%8d%e5%ae%9a%e5%90%91%e8%a1%a8">移动导出表，重定向表
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%af%bc%e5%85%a5%e8%a1%a8">导入表
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%91%e5%ae%9a%e5%af%bc%e5%85%a5%e8%a1%a8">绑定导入表
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%b3%a8%e5%85%a5%e5%85%a5%e9%97%a8">注入入门
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#win32">win32
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%ae%bd%e5%ad%97%e7%ac%a6">宽字符
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e4%ba%8b%e4%bb%b6-%e6%b6%88%e6%81%af">事件-消息
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%ad%90%e7%aa%97%e5%8f%a3-%e6%b6%88%e6%81%af%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0">子窗口-消息处理函数
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e8%b5%84%e6%ba%90%e8%a1%a8pe">资源表（PE）
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#wm_notify">WM_NOTIFY
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%ba%bf%e7%a8%8b">线程
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%ba%bf%e7%a8%8b%e6%8e%a7%e5%88%b6">线程控制
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e4%b8%b4%e7%95%8c%e5%8c%ba">临界区
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e4%ba%92%e6%96%a5%e4%bd%93">互斥体
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e4%ba%8b%e4%bb%b6">事件
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e4%bf%a1%e5%8f%b7%e9%87%8f">信号量
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e8%bf%9b%e7%a8%8b">进程
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%8f%a5%e6%9f%84%e8%a1%a8">句柄表
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%8a%a0%e5%af%86%e5%a3%b3">加密壳
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%bc%a0%e6%a0%87_%e7%aa%97%e5%8f%a3">鼠标_窗口
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e8%bf%9c%e7%a8%8b%e7%ba%bf%e7%a8%8b%e6%b3%a8%e5%85%a5">远程线程注入
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%86%85%e5%ad%98%e5%86%99%e5%85%a5">内存写入
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#iat-hook">IAT Hook
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#inline-hook">Inline Hook
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%a1%ac%e7%bc%96%e7%a0%81">硬编码
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%8f%e5%85%b8%e5%ae%9a%e9%95%bf%e6%8c%87%e4%bb%a4%e4%bf%ae%e6%94%b9%e5%af%84%e5%ad%98%e5%99%a8">经典定长指令（修改寄存器）
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%8f%e5%85%b8%e5%ae%9a%e9%95%bf%e6%8c%87%e4%bb%a4%e4%b8%8b%e4%bf%ae%e6%94%b9eip">经典定长指令下(修改EIP)
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%8f%e5%85%b8%e5%8f%98%e9%95%bf%e6%8c%87%e4%bb%a4_modrm">经典变长指令（_ModR/M）
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%8f%e5%85%b8%e5%8f%98%e9%95%bf%e6%8c%87%e4%bb%a4_sib%e5%ad%97%e6%ae%b5">经典变长指令（_SIB字段）
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%8f%e5%85%b8%e5%8f%98%e9%95%bf%e6%8c%87%e4%bb%a4_regopcode">经典变长指令（_Reg/Opcode）
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%8c%87%e4%bb%a4%e5%89%8d%e7%bc%80">指令前缀
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-16 rtl:hx-pr-16 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%80%bb%e7%bb%93">总结
        </a>
      </li></ul>
      <div class="hx-mt-8 hx-border-t hx-bg-white hx-pt-8 hx-shadow-[0_-12px_16px_white] dark:hx-bg-dark dark:hx-shadow-[0_-12px_16px_#111] hx-sticky hx-bottom-0 hx-flex hx-flex-col hx-items-start hx-gap-2 hx-pb-8 dark:hx-border-neutral-800 contrast-more:hx-border-t contrast-more:hx-border-neutral-400 contrast-more:hx-shadow-none contrast-more:dark:hx-border-neutral-400">
        <button aria-hidden="true" id="backToTop" onClick="scrollUp();" class="hx-transition-all hx-duration-75 hx-opacity-0 hx-text-xs hx-font-medium hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-100 contrast-more:hx-text-gray-800 contrast-more:dark:hx-text-gray-50">
          <span>Scroll to top</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hx-inline ltr:hx-ml-1 rtl:hx-mr-1 hx-h-3.5 hx-w-3.5 hx-border hx-rounded-full hx-border-gray-500 hover:hx-border-gray-900 dark:hx-border-gray-400 dark:hover:hx-border-gray-100 contrast-more:hx-border-gray-800 contrast-more:dark:hx-border-gray-50">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
          </svg>
        </button>
      </div>
    </div>
  </nav>


    <article class="hx-w-full hx-break-words hx-flex hx-min-h-[calc(100vh-var(--navbar-height))] hx-min-w-0 hx-justify-center hx-pb-8 hx-pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx-w-full hx-min-w-0 hx-max-w-6xl hx-px-6 hx-pt-4 md:hx-px-12">
        
  <div class="hx-mt-1.5 hx-flex hx-items-center hx-gap-1 hx-overflow-hidden hx-text-sm hx-text-gray-500 dark:hx-text-gray-400 contrast-more:hx-text-current">
        <div class="hx-whitespace-nowrap hx-transition-colors hx-min-w-[24px] hx-overflow-hidden hx-text-ellipsis hover:hx-text-gray-900 dark:hover:hx-text-gray-100">
          <a href="/docs/">Docs</a>
        </div><svg class="hx-w-3.5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
        <div class="hx-whitespace-nowrap hx-transition-colors hx-min-w-[24px] hx-overflow-hidden hx-text-ellipsis hover:hx-text-gray-900 dark:hover:hx-text-gray-100">
          <a href="/docs/windows/">Windows</a>
        </div><svg class="hx-w-3.5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg><div class="hx-whitespace-nowrap hx-transition-colors hx-font-medium hx-text-gray-700 contrast-more:hx-font-bold contrast-more:hx-text-current dark:hx-text-gray-100 contrast-more:dark:hx-text-current">Windows BEG</div>
  </div>

        <div class="content">
          <h1>Windows BEG</h1>
          <h3>PE文件结构<span class="hx-absolute -hx-mt-20" id="pe文件结构"></span>
    <a href="#pe%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><h6>总体结构<span class="hx-absolute -hx-mt-20" id="总体结构"></span>
    <a href="#%e6%80%bb%e4%bd%93%e7%bb%93%e6%9e%84" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p><img src="https://c65mael.github.io/static/myassets-beg/image-20240124021409-650cwqy.png" alt="image" loading="lazy" />​​</p>
<ul>
<li>
<p>程序在内存中是分节的，每一个节存储不同的数据，硬盘对齐(<code>200h</code>)，内存对齐(<code>1000h</code>)。因为程序在硬盘上和内存中的状态可能略有不同(以前的程序在内存中与在硬盘上，在内存中节与节之间会有一个&quot;拉伸&quot;过程，节与节之间的空隙变大(填充0)。而现在的程序则并不会。)，这样做可以:</p>
<ul>
<li>节省硬盘空间。</li>
<li>实现多开(将只读的节保留，将可读可写的节多开，可以节省内存空间)。</li>
</ul>
<p><img src="https://c65mael.github.io/static/myassets-beg/image-20240124024811-j31e5w4.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>头的大致结构如下：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">结构</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">DOS头</td>
      </tr>
      <tr>
          <td style="text-align: center">标准PE头</td>
      </tr>
      <tr>
          <td style="text-align: center">可选PE头</td>
      </tr>
      <tr>
          <td style="text-align: center">节表</td>
      </tr>
  </tbody>
</table>
</li>
</ul>
<p><strong>结构解释：</strong></p>
<ol>
<li>
<p>DOS头（<code>IMAGE_DOS_HEADER</code>）最早是为16位的DOS程序设计的，因此包含了一些与DOS相关的信息。现代的Windows可执行文件（PE格式）仍然保留了DOS头，以便在DOS环境下运行时能显示“此程序不能在DOS模式下运行”的消息。DOS头的第一个字段是<code>WORD e_magic</code>，通常为<code>0x5A4D</code>，即字符“MZ”，用于标识这是一个有效的DOS可执行文件头。另一个重要字段是<code>DWORD e_lfanew</code>，它保存了PE头（<code>IMAGE_NT_HEADERS</code>）在文件中的偏移量。程序在解析PE文件时，会从<code>e_lfanew</code>字段找到PE头的位置。值得注意的是，在<code>e_lfanew</code>和PE标识符（“PE”，即<code>0x5045</code>）之间的部分数据通常被认为是“垃圾数据”，这些数据在现代Windows系统中没有实际用途，只是为了保持文件结构的兼容性。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>	1、DOS头：										

	WORD   e_magic                *				&#34;MZ标记&#34; 用于判断是否为可执行文件.						
	DWORD  e_lfanew;              *				PE头相对于文件的偏移，用于定位标准PE头</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>在找到PE标识符“PE\0\0”（<code>0x50450000</code>）后，接下来就是（<code>IMAGE_NT_HEADERS</code>）<strong>NT头</strong>的内容。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_NT_HEADERS {
</span></span><span style="display:flex;"><span>    DWORD Signature;                 <span style="color:#75715e">// 文件签名，通常为&#39;PE\0\0&#39;（0x00004550），用于标识这是一个有效的PE文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    IMAGE_FILE_HEADER FileHeader;    <span style="color:#75715e">// 标准PE头，包含文件的基本信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    IMAGE_OPTIONAL_HEADER OptionalHeader; <span style="color:#75715e">// 可选PE头，包含加载和运行时的详细信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} IMAGE_NT_HEADERS, <span style="color:#f92672">*</span>PIMAGE_NT_HEADERS;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>文件签名紧随其后的是<code>FileHeader</code>（<code>IMAGE_FILE_HEADER</code>），通常被称为<strong>标准PE头</strong>或<code>COFF</code>头，包含文件的基本信息。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>2、标准PE头：										

	WORD    Machine;              *				程序运行的CPU型号：0x0 任何处理器/0x14C 386及后续处理器						
	WORD    NumberOfSections;     *				文件中存在的节的总数,如果要新增节或者合并节 就要修改这个值.						
	DWORD   TimeDateStamp;        *				时间戳：文件的创建时间(和操作系统的创建时间无关)，编译器填写的.						
	DWORD   PointerToSymbolTable;

	DWORD   NumberOfSymbols;

	WORD    SizeOfOptionalHeader; *				可选PE头的大小，32位PE文件默认E0h 64位PE文件默认为F0h  大小可以自定义.						
	WORD    Characteristics;      *				每个位有不同的含义，可执行文件值为10F 即0 1 2 3 8位置1 				</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p><code>Characteristics</code> 标志位如下：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">标号</th>
          <th style="text-align: left">Characteristics 标志位</th>
          <th style="text-align: center">属性</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">0</td>
          <td style="text-align: left">IMAGE_FILE_RELOCS_STRIPPED</td>
          <td style="text-align: center">重定位信息已被剥离，意味着文件中不包含重定位信息</td>
      </tr>
      <tr>
          <td style="text-align: left">1</td>
          <td style="text-align: left">IMAGE_FILE_EXECUTABLE_IMAGE</td>
          <td style="text-align: center">文件是可执行的，可以作为应用程序直接运行</td>
      </tr>
      <tr>
          <td style="text-align: left">2</td>
          <td style="text-align: left">IMAGE_FILE_LINE_NUMS_STRIPPED</td>
          <td style="text-align: center">行号信息已被剥离，意味着文件中不包含行号信息</td>
      </tr>
      <tr>
          <td style="text-align: left">3</td>
          <td style="text-align: left">IMAGE_FILE_LOCAL_SYMS_STRIPPED</td>
          <td style="text-align: center">符号信息已被剥离，意味着文件中不包含局部符号信息</td>
      </tr>
      <tr>
          <td style="text-align: left">4</td>
          <td style="text-align: left">IMAGE_FILE_AGGRESIVE_WS_TRIM</td>
          <td style="text-align: center">调整工作集，优化内存使用</td>
      </tr>
      <tr>
          <td style="text-align: left">5</td>
          <td style="text-align: left">IMAGE_FILE_LARGE_ADDRESS_AWARE</td>
          <td style="text-align: center">应用程序可以处理大于 2GB 的地址空间</td>
      </tr>
      <tr>
          <td style="text-align: left">6</td>
          <td style="text-align: left"></td>
          <td style="text-align: center">此标志位保留，没有特定的属性</td>
      </tr>
      <tr>
          <td style="text-align: left">7</td>
          <td style="text-align: left">IMAGE_FILE_BYTES_REVERSED_LO</td>
          <td style="text-align: center">字节顺序反转（低字节序），文件采用小尾方式存储数据</td>
      </tr>
      <tr>
          <td style="text-align: left">8</td>
          <td style="text-align: left">IMAGE_FILE_32BIT_MACHINE</td>
          <td style="text-align: center">只在 32 位平台上运行</td>
      </tr>
      <tr>
          <td style="text-align: left">9</td>
          <td style="text-align: left">IMAGE_FILE_DEBUG_STRIPPED</td>
          <td style="text-align: center">不包含调试信息</td>
      </tr>
      <tr>
          <td style="text-align: left">10</td>
          <td style="text-align: left">IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP</td>
          <td style="text-align: center">不能从可移动盘运行</td>
      </tr>
      <tr>
          <td style="text-align: left">11</td>
          <td style="text-align: left">IMAGE_FILE_NET_RUN FROM_SWAP</td>
          <td style="text-align: center">不能从网络运行</td>
      </tr>
      <tr>
          <td style="text-align: left">12</td>
          <td style="text-align: left">IMAGE_FILE_SYSTEM</td>
          <td style="text-align: center">系统文件（如驱动程序),不能直接运行</td>
      </tr>
      <tr>
          <td style="text-align: left">13</td>
          <td style="text-align: left">IMAGE_FILE_DLL</td>
          <td style="text-align: center">这是一个 DLL 文件</td>
      </tr>
      <tr>
          <td style="text-align: left">14</td>
          <td style="text-align: left">IMAGE_FILE_UP_SYSTEM_ONLY</td>
          <td style="text-align: center">文件不能在多处理器计算机上运行</td>
      </tr>
      <tr>
          <td style="text-align: left">15</td>
          <td style="text-align: left">IMAGE_FILE_BYTES_REVERSED_HI</td>
          <td style="text-align: center">大尾方式</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>紧接着，就是可选(扩展)PE头(<code>IMAGE_OPTIONAL_HEADER</code>):</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>3、可选PE头：										

	WORD    Magic;      		  *		        说明文件类型：10B 32位下的PE文件     20B 64位下的PE文件						
	BYTE    MajorLinkerVersion;

	BYTE    MinorLinkerVersion;

	DWORD   SizeOfCode;*						所有代码节的和，必须是FileAlignment的整数倍 编译器填的  没用						
	DWORD   SizeOfInitializedData;*				 已初始化数据大小的和,必须是FileAlignment的整数倍 编译器填的  没用						
	DWORD   SizeOfUninitializedData;*			 未初始化数据大小的和,必须是FileAlignment的整数倍 编译器填的  没用						
	DWORD   AddressOfEntryPoint;*				 程序入口						
	DWORD   BaseOfCode;*						代码开始的基址，编译器填的   没用						
	DWORD   BaseOfData;*						数据开始的基址，编译器填的   没用						
	DWORD   ImageBase;*							内存镜像基址						
	DWORD   SectionAlignment;*					 内存对齐						
	DWORD   FileAlignment;*						 文件对齐						
	WORD    MajorOperatingSystemVersion;										
	WORD    MinorOperatingSystemVersion;										
	WORD    MajorImageVersion;										
	WORD    MinorImageVersion;										
	WORD    MajorSubsystemVersion;										
	WORD    MinorSubsystemVersion;										
	DWORD   Win32VersionValue;										
	DWORD   SizeOfImage;*			 内存中整个PE文件的映射的尺寸，可以比实际的值大，但必须是SectionAlignment的整数倍						
	DWORD   SizeOfHeaders;*						所有头&#43;节表按照文件对齐后的大小，否则加载会出错						
	DWORD   CheckSum;*							校验和，一些系统文件有要求.用来判断文件是否被修改.						
	WORD    Subsystem;										
	WORD    DllCharacteristics;										
	DWORD   SizeOfStackReserve;*				初始化时保留的堆栈大小 						
	DWORD   SizeOfStackCommit;*					初始化时实际提交的大小 					
	DWORD   SizeOfHeapReserve;*					初始化时保留的堆大小 				
	DWORD   SizeOfHeapCommit;*					初始化时实践提交的大小 				
	DWORD   LoaderFlags;								
	DWORD   NumberOfRvaAndSizes;*				目录项数目</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p><code>DllCharacteristics</code>属性如下：</p>
<table>
  <thead>
      <tr>
          <th>标志位</th>
          <th style="text-align: center">DllCharacteristics属性</th>
          <th style="text-align: center">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td style="text-align: center">Reserved</td>
          <td style="text-align: center">必须为0</td>
      </tr>
      <tr>
          <td>1</td>
          <td style="text-align: center">Reserved</td>
          <td style="text-align: center">必须为0</td>
      </tr>
      <tr>
          <td>2</td>
          <td style="text-align: center">Reserved</td>
          <td style="text-align: center">必须为0</td>
      </tr>
      <tr>
          <td>3</td>
          <td style="text-align: center">Reserved</td>
          <td style="text-align: center">必须为0</td>
      </tr>
      <tr>
          <td>4</td>
          <td style="text-align: center">null</td>
          <td style="text-align: center">null</td>
      </tr>
      <tr>
          <td>5</td>
          <td style="text-align: center">null</td>
          <td style="text-align: center">null</td>
      </tr>
      <tr>
          <td>6</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE</td>
          <td style="text-align: center">DLL可以在加载时被重定位</td>
      </tr>
      <tr>
          <td>7</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY</td>
          <td style="text-align: center">强制代码实施完整性验证</td>
      </tr>
      <tr>
          <td>8</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_NX_COMPAT</td>
          <td style="text-align: center">该映像兼容 DEP</td>
      </tr>
      <tr>
          <td>9</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_NO_ISOLATION</td>
          <td style="text-align: center">可以隔离，但并不隔离此映像</td>
      </tr>
      <tr>
          <td>10</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_NO_SEH</td>
          <td style="text-align: center">没有结构化异常处理（SEH）</td>
      </tr>
      <tr>
          <td>11</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_NO_BIND</td>
          <td style="text-align: center">不绑定映像</td>
      </tr>
      <tr>
          <td>12</td>
          <td style="text-align: center">Reserved</td>
          <td style="text-align: center">必须为0</td>
      </tr>
      <tr>
          <td>13</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_WDM_DRIVER</td>
          <td style="text-align: center">该映像为一个 WDM driver</td>
      </tr>
      <tr>
          <td>14</td>
          <td style="text-align: center">Reserved</td>
          <td style="text-align: center">必须为0</td>
      </tr>
      <tr>
          <td>15</td>
          <td style="text-align: center">IMAGE_DLLCHARACTERISTICS_TERMINAL SERVER_AWARE</td>
          <td style="text-align: center">可用于终端服务器</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>最后就是节表</p>
<ul>
<li>如果节相当于书里面的内容，那么节表就相当于书的目录。之前的什么<code>DOS</code>头之类的结构就相当于书的出版社什么的信息。</li>
</ul>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_SECTION_HEADER {
</span></span><span style="display:flex;"><span>    BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];     <span style="color:#75715e">// 节的名称，长度为8个字节。通常是以&#34;\0&#34;结尾的ASCII字符串，但系统会截取8个字节的内容。名称可以自定义。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">union</span> {
</span></span><span style="display:flex;"><span>        DWORD   PhysicalAddress;               <span style="color:#75715e">// 在COFF格式中用于指示物理地址。对于PE文件通常不使用。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        DWORD   VirtualSize;                   <span style="color:#75715e">// 节的虚拟大小。在内存中的实际大小可以与SizeOfRawData不同。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    } Misc;									<span style="color:#75715e">// 双字是该节在没有对齐前的真实尺寸,该值可以不准确。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   VirtualAddress;                    <span style="color:#75715e">// 节在内存中的虚拟地址，加上ImageBase才是内存中的实际地址。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   SizeOfRawData;                     <span style="color:#75715e">// 节在文件中的对齐后的大小。在文件中的实际大小。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   PointerToRawData;                  <span style="color:#75715e">// 节在文件中的偏移地址，指向节的实际数据。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   PointerToRelocations;              <span style="color:#75715e">// 对于obj文件中的重定位信息使用。对于exe文件，通常为0。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   PointerToLinenumbers;              <span style="color:#75715e">// 行号表的偏移，用于调试。对于exe文件，通常为0。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    NumberOfRelocations;               <span style="color:#75715e">// 在obj文件中使用，指示节中重定位的数量。对于exe文件，通常为0。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    NumberOfLinenumbers;               <span style="color:#75715e">// 行号表中行号的数量，用于调试。对于exe文件，通常为0。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   Characteristics;                  <span style="color:#75715e">// 节的属性标志，如是否为可执行代码、是否可读、是否可写等。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} IMAGE_SECTION_HEADER, <span style="color:#f92672">*</span>PIMAGE_SECTION_HEADER;			
</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>所以，节表的结构如下：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/jb.png" alt="image" loading="lazy" /></p>
</li>
</ol>
<p>完整如下：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>	1、DOS头：										
											
	WORD   e_magic                *				&#34;MZ标记&#34; 用于判断是否为可执行文件.						
	DWORD  e_lfanew;              *				PE头相对于文件的偏移，用于定位PE文件						
											
											
	2、标准PE头：										
											
	WORD    Machine;              *				程序运行的CPU型号：0x0 任何处理器/0x14C 386及后续处理器						
	WORD    NumberOfSections;     *				文件中存在的节的总数,如果要新增节或者合并节 就要修改这个值.						
	DWORD   TimeDateStamp;        *				时间戳：文件的创建时间(和操作系统的创建时间无关)，编译器填写的.						
	DWORD   PointerToSymbolTable;

	DWORD   NumberOfSymbols;

	WORD    SizeOfOptionalHeader; *				可选PE头的大小，32位PE文件默认E0h 64位PE文件默认为F0h  大小可以自定义.						
	WORD    Characteristics;      *				每个位有不同的含义，可执行文件值为10F 即0 1 2 3 8位置1 						
											
	3、可选PE头：										
											
	WORD    Magic;      		  *		        说明文件类型：10B 32位下的PE文件     20B 64位下的PE文件						
	BYTE    MajorLinkerVersion;

	BYTE    MinorLinkerVersion;

	DWORD   SizeOfCode;*						所有代码节的和，必须是FileAlignment的整数倍 编译器填的  没用						
	DWORD   SizeOfInitializedData;*				 已初始化数据大小的和,必须是FileAlignment的整数倍 编译器填的  没用						
	DWORD   SizeOfUninitializedData;*			 未初始化数据大小的和,必须是FileAlignment的整数倍 编译器填的  没用						
	DWORD   AddressOfEntryPoint;*				 程序入口						
	DWORD   BaseOfCode;*						代码开始的基址，编译器填的   没用						
	DWORD   BaseOfData;*						数据开始的基址，编译器填的   没用						
	DWORD   ImageBase;*							内存镜像基址						
	DWORD   SectionAlignment;*					 内存对齐						
	DWORD   FileAlignment;*						 文件对齐						
	WORD    MajorOperatingSystemVersion;										
	WORD    MinorOperatingSystemVersion;										
	WORD    MajorImageVersion;										
	WORD    MinorImageVersion;										
	WORD    MajorSubsystemVersion;										
	WORD    MinorSubsystemVersion;										
	DWORD   Win32VersionValue;										
	DWORD   SizeOfImage;*			 内存中整个PE文件的映射的尺寸，可以比实际的值大，但必须是SectionAlignment的整数倍						
	DWORD   SizeOfHeaders;*						所有头&#43;节表按照文件对齐后的大小，否则加载会出错						
	DWORD   CheckSum;*							校验和，一些系统文件有要求.用来判断文件是否被修改.						
	WORD    Subsystem;										
	WORD    DllCharacteristics;										
	DWORD   SizeOfStackReserve;*				初始化时保留的堆栈大小 						
	DWORD   SizeOfStackCommit;*					初始化时实际提交的大小 					
	DWORD   SizeOfHeapReserve;*					初始化时保留的堆大小 				
	DWORD   SizeOfHeapCommit;*					初始化时实践提交的大小 				
	DWORD   LoaderFlags;								
	DWORD   NumberOfRvaAndSizes;*				目录项数目</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<ul>
<li>
<p>PE加载的过程：</p>
<ol>
<li>根据<code>SizeOfImage</code>的大小，开辟一块缓冲区(<code>ImageBuffer</code>)</li>
<li>根据<code>SizeOfHeader</code>的大小，将头信息从<code>FileBuffer</code>拷贝到<code>ImageBuffer</code></li>
<li>根据节表中的信息循环将<code>FileBuffer</code>中的节拷贝到<code>ImageBuffer</code>中</li>
</ol>
<p><img src="https://c65mael.github.io/static/myassets-beg/pejz.png" alt="image" loading="lazy" /></p>
</li>
</ul>
<h6>‍RVA与FOA的转换<span class="hx-absolute -hx-mt-20" id="rva与foa的转换"></span>
    <a href="#rva%e4%b8%8efoa%e7%9a%84%e8%bd%ac%e6%8d%a2" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>因为运行的程序全局变量的初始值在未运行的程序中也存在，所以我们如何通过运行程序的地址的值，来推出程序在未运行时这个值对应的地址。</p>
<ol>
<li>
<p><code>‍RVA</code>相对虚拟地址</p>
<p><code>‍RVA=address(程序运行时要找值的地址)-ImageBase</code></p>
</li>
<li>
<p><code>FOA</code>文件偏移地址(程序未运行要找的地址)</p>
</li>
<li>
<p>对应关系(不过现在的程序运行和未运行是对齐都相等，所以直接<code>FOA=RVA</code>)：</p>
<ul>
<li>
<p>如果在头部(前面没有节的对齐) <code>FOA=RVA</code></p>
</li>
<li>
<p>不在头部(节内的差值是相同的)</p>
</li>
</ul>
</li>
</ol>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>RVA &gt;=节.VirtualAddress

RVA &lt;= 节.VirtualAddress &#43; 当前节内存对齐后的大小

差值 = RVA - 节.VirtualAddress

FOA =节.PointerToRawData &#43;差值</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<h6>实验：在编译好的程序执行前弹个窗口<span class="hx-absolute -hx-mt-20" id="实验在编译好的程序执行前弹个窗口"></span>
    <a href="#%e5%ae%9e%e9%aa%8c%e5%9c%a8%e7%bc%96%e8%af%91%e5%a5%bd%e7%9a%84%e7%a8%8b%e5%ba%8f%e6%89%a7%e8%a1%8c%e5%89%8d%e5%bc%b9%e4%b8%aa%e7%aa%97%e5%8f%a3" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ol>
<li>
<p>汇编对应硬编码</p>
<p><code>6A 00</code> ：<code>push 0</code>	<code>E8 跳转值</code> ：<code>call 要跳转的地址</code></p>
</li>
<li>
<p>计算要跳转地址的硬编码：</p>
</li>
</ol>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>跳转值=要跳转的地址-E8(call)指令当前的地址-5(对齐到下一个指令)</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<h6>扩大节<span class="hx-absolute -hx-mt-20" id="扩大节"></span>
    <a href="#%e6%89%a9%e5%a4%a7%e8%8a%82" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>当我们想添加的代码或者<code>shellcode</code>比较多，程序没地方写的话可以选择扩大节，由于对齐的原因，扩大最后一个节对其他节的影响最小，是最优选择</p>
<p>扩大节的步骤：</p>
<ol>
<li>
<p>分配一块新的空间,大小为<code>S</code></p>
</li>
<li>
<p>将最后一个节的<code>SizeOfRawData</code>和<code>VirtualSize</code>改成<code>N</code></p>
<p><code>N = (SizeOfRawData或者VirtualSize内存对齐后的值) + S</code></p>
</li>
<li>
<p>修改<code>SizeOflmage</code>大小</p>
</li>
</ol>
<h6>新增节<span class="hx-absolute -hx-mt-20" id="新增节"></span>
    <a href="#%e6%96%b0%e5%a2%9e%e8%8a%82" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>新增节的步骤：</p>
<ol>
<li>判断是否有足够的空间,可以添加一个节表.</li>
<li>在节表中新增一个成员.</li>
<li>修改<code>PE</code>头中节的数量.</li>
<li>修改<code>sizeOflmage</code>的大小.</li>
<li>再原有数据的最后,新增一个节的数据(内存对齐的整数倍).</li>
<li>修正新增节表的属性.</li>
</ol>
<h6>静态链接库-动态链接库<span class="hx-absolute -hx-mt-20" id="静态链接库-动态链接库"></span>
    <a href="#%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e5%ba%93-%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5%e5%ba%93" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>静态链接库：</p>
<ul>
<li>将<code>xxx.h</code>和<code>xxx.lib</code>复制到要使用的项目中（就是你写的<code>lib</code>）</li>
<li>在需要使用的文件中包含：<code>#include &quot;xxx.h&quot;</code></li>
<li>在需要使用的文件中包含：<code>#pragma comment(lib, &quot;xxx.lib&quot;)</code>；或者改项目设置中的<code>link</code>将<code>xxx.lib</code>加入</li>
</ul>
<blockquote>
  <p>使用静态链接库其实就是把你写的<code>xxx.h</code>文件里的函数全部编译到程序里面了，使用静态链接生成的可执行文件体积较大，造成浪费。</p>
</blockquote>
<p>动态链接库：</p>
<ul>
<li>
<p>隐式链接：（就是编译器替你去链接）</p>
<ul>
<li>
<p>将<code>*.dll  *.lib</code>放到工程目录下面（主要功能在<code>dll</code>里面，这个<code>lib</code>其实就是告诉程序函数在哪里）</p>
</li>
<li>
<p>将<code>#pragma comment(lib,&quot;DLL名.lib&quot;)</code>添加到调用文件中</p>
</li>
<li>
<p>加入函数的声明：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> <span style="color:#66d9ef">__declspec</span>(dllimport) <span style="color:#66d9ef">__stdcall</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Plus</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> <span style="color:#66d9ef">__declspec</span>(dllimport) <span style="color:#66d9ef">__stdcall</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Sub</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> <span style="color:#66d9ef">__declspec</span>(dllimport) <span style="color:#66d9ef">__stdcall</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Mul</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> <span style="color:#66d9ef">__declspec</span>(dllimport) <span style="color:#66d9ef">__stdcall</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Div</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<blockquote>
  <p><code>__declspec(dllimport)</code>告诉编译器此函数为导入函数；</p>
<p><code>__declspec(dllexport)</code>告诉编译器此函数为导出函数；</p>
<p><code>extern &quot;C&quot;</code>的意思是用<code>C</code>语言的语法进行编译和链接，去掉的话函数名称后面会加乱码，作用是名称粉碎</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>显示链接：（自己去链接）</p>
<ul>
<li>
<p>定义函数指针：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#66d9ef">__stdcall</span> <span style="color:#f92672">*</span>lpPlus)(<span style="color:#66d9ef">int</span>,<span style="color:#66d9ef">int</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#66d9ef">__stdcall</span> <span style="color:#f92672">*</span>lpSub)(<span style="color:#66d9ef">int</span>,<span style="color:#66d9ef">int</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#66d9ef">__stdcall</span> <span style="color:#f92672">*</span>lpMul)(<span style="color:#66d9ef">int</span>,<span style="color:#66d9ef">int</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#66d9ef">__stdcall</span> <span style="color:#f92672">*</span>lpDiv)(<span style="color:#66d9ef">int</span>,<span style="color:#66d9ef">int</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//定义新的类型
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>声明函数指针变量：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>lpPlus myPlus;
</span></span><span style="display:flex;"><span>lpSub mySub;
</span></span><span style="display:flex;"><span>lpMul myMul;
</span></span><span style="display:flex;"><span>lpDiv myDiv;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>动态加载<code>dll</code>到内存中：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>HINSTANCE   hModule <span style="color:#f92672">=</span> <span style="color:#a6e22e">LoadLibrary</span>(<span style="color:#e6db74">&#34;DllDemo.dll&#34;</span>); 
</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>获取函数地址：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>myPlus <span style="color:#f92672">=</span> (lpPlus)<span style="color:#a6e22e">GetProcAddress</span>(hModule,   <span style="color:#e6db74">&#34;_Plus@8&#34;</span>);
</span></span><span style="display:flex;"><span>mySub <span style="color:#f92672">=</span> (lpSub)<span style="color:#a6e22e">GetProcAddress</span>(hModule,   <span style="color:#e6db74">&#34;_Sub@8&#34;</span>);
</span></span><span style="display:flex;"><span>myMul <span style="color:#f92672">=</span> (lpMul)<span style="color:#a6e22e">GetProcAddress</span>(hModule,   <span style="color:#e6db74">&#34;_Mul@8&#34;</span>);
</span></span><span style="display:flex;"><span>myDiv <span style="color:#f92672">=</span> (lpDiv)<span style="color:#a6e22e">GetProcAddress</span>(hModule,   <span style="color:#e6db74">&#34;_Div@8&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//@后面的8是指后面有两个参数，一个参数4字节
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>调用函数：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#a6e22e">myPlus</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#a6e22e">mySub</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#a6e22e">myMul</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> d <span style="color:#f92672">=</span> <span style="color:#a6e22e">myDiv</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<blockquote>
  <p><code>Handle</code>是代表系统的内核对象，如文件句柄，线程句柄，进程句柄。其实就是操作系统分的一个文件编号，线程编号或者是进程编号。避免用户将句柄进行运算（<code>unsign</code>4字节）</p>
<p><code>GetProcAddress</code>的第一个参数<code>hModule</code>其实就是模块的<code>RVA</code></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>使用序号导出：</p>
<ul>
<li>
<p><code>*.h</code>文件：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Plus</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Sub</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Mul</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Div</span> (<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p><code>*.cpp</code>文件：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Plus</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> x<span style="color:#f92672">+</span>y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Sub</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> x<span style="color:#f92672">-</span>y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Mul</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> x<span style="color:#f92672">*</span>y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Div</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> x<span style="color:#f92672">/</span>y;	
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p><code>*.def</code>文件：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>EXPORTS

Plus @12
Sub	@15 NONAME
Mul @13
Div @16</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>后面的数字就是函数的导出序号，<code>NONAME</code>指的是无名字，隐藏名称</p>
<blockquote>
  <p>名字是一段程序就精华的注释,通过名字可以直接猜测到函数的功能，通过使用序号，可以达到隐藏的目的.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h6>导出表<span class="hx-absolute -hx-mt-20" id="导出表"></span>
    <a href="#%e5%af%bc%e5%87%ba%e8%a1%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>一个程序是由多个配文件所组成，那么这个程序使用了哪些<code>dll</code>文件，会在一个表中记录，这就是导入表；同样的，有哪些程序使用了我这个程序的函数，也会记录在一个表内，这个表是导出表。</p>
<p>如何找到导出表：<code>pe</code>文件结构中最后一个结构中的第一个结构体，那里存放着导出表的地址(<code>rva</code>)和大小(<code>size</code>)</p>
<p>请注意，这个大小(<code>size</code>)指的是导出表中的指针指向的内容的和大小（比如<code>name</code>指针指向的字段以<code>\x00</code>截至，等等的所有字段和加上固定的40个字节，只是编译器填的值，无实际意义）</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>IMAGE_DIRECTORY_ENTRY_EXPORT
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>struct_IMAGE_DATA_DIRECTORY { 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00</span> DWORD VirtualAddress; 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x04</span> DWORD Size;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>通过这个地址就可以找到导出表，结构如下：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_EXPORT_DIRECTORY {
</span></span><span style="display:flex;"><span>    DWORD   Characteristics;        <span style="color:#75715e">//未使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   TimeDateStamp;          <span style="color:#75715e">//时间戳
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    MajorVersion;           <span style="color:#75715e">//未使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    MinorVersion;           <span style="color:#75715e">//未使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   Name;                   <span style="color:#75715e">//指向改导出表文件名字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   Base;                   <span style="color:#75715e">//导出表的起始序号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   NumberOfFunctions;      <span style="color:#75715e">//导出函数的个数(更准确来说是AddressOfFunctions的元素数，而不是函数个数)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   NumberOfNames;          <span style="color:#75715e">//以函数名字导出的函数个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   AddressOfFunctions;     <span style="color:#75715e">//导出函数地址表RVA:存储所有导出函数地址(表元素宽度为4，总大小NumberOfFunctions * 4)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   AddressOfNames;         <span style="color:#75715e">//导出函数名称表RVA:存储函数名字符串所在的地址(表元素宽度为4，总大小为NumberOfNames * 4)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   AddressOfNameOrdinals;  <span style="color:#75715e">//导出函数序号表RVA:存储函数序号(表元素宽度为2，总大小为NumberOfNames * 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} IMAGE_EXPORT_DIRECTORY, <span style="color:#f92672">*</span>PIMAGE_EXPORT_DIRECTORY;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>1.导出的函数要么用名字导出，要么用序号导出(隐藏)，总数为<code>NumberOfNames</code>的值</p>
<p>一共有三个表，地址表，序号表，名称表</p>
<p>其中：序号表的数量与名称表的数量相同。</p>
<p>比如：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">地址表</th>
          <th style="text-align: center">序号表(2字节)</th>
          <th style="text-align: center">名称表</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">addr1(knameA)</td>
          <td style="text-align: center">4</td>
          <td style="text-align: center">ADDR1(AAAA)</td>
      </tr>
      <tr>
          <td style="text-align: center">addr2(knameB)</td>
          <td style="text-align: center">1</td>
          <td style="text-align: center">ADDR2(BBBB)</td>
      </tr>
      <tr>
          <td style="text-align: center">addr3(knameC)</td>
          <td style="text-align: center">0</td>
          <td style="text-align: center">ADDR3(CCCC)</td>
      </tr>
      <tr>
          <td style="text-align: center">00000000</td>
          <td style="text-align: center"></td>
          <td style="text-align: center"></td>
      </tr>
      <tr>
          <td style="text-align: center">addr4(knameD)</td>
          <td style="text-align: center"></td>
          <td style="text-align: center"></td>
      </tr>
  </tbody>
</table>
<pre class="mermaid hx-mt-6">
  erDiagram
	Address_table {
        address addr1(knameA)
        address addr2(knameB)
        address addr3(knameC)
        address NULL
        address addr4(knameD)
    }

	Serial_number_table {
        number four
        number one
        number zero
    }

	Name_table {
        name ADDR1(AAAA)
        name ADDR2(BBBB)
        name ADDR3(CCCC)
    }
</pre><p><strong>通过名字找函数时</strong>：（按照名称找函数地址）</p>
<pre class="mermaid hx-mt-6">
  graph RL
    AAAA --&gt; 4 --&gt; knameD
</pre><ol>
<li>首先遍历名称表，比如找到名称<code>AAAA</code>函数，发现是表中的第<code>0</code>号成员。</li>
<li>通过①中的<code>0</code>直接查询序号表中的<code>0</code>号成员，发现是数字<code>4</code></li>
<li>通过②中的<code>4</code>直接查找地址表中的第<code>4</code>号成员，为<code>addr4(knameD)</code>，所以<code>knameD</code>就是<code>AAAA</code>（从<code>0</code>开始数）</li>
</ol>
<p>相反过程：（知道函数地址找函数名）</p>
<pre class="mermaid hx-mt-6">
  graph LR
    knameA --&gt; 0 --&gt; CCCC
</pre><ol>
<li>比如知道函数的地址为<code>addr1(knameA)</code>，发现是地址表中的第<code>0</code>号成员。</li>
<li>通过①中的<code>0</code>直接查询序号表中的成员哪个是<code>0</code>，发现是第二个索引</li>
<li>直接对应名称表的第二个索引，所以<code>ADDR3(CCCC)</code>就是<code>addr1(knameA)</code></li>
</ol>
<p><strong>通过序号找函数时</strong>：（按照序号找函数地址）</p>
<pre class="mermaid hx-mt-6">
  graph RL
    4 --&gt; knameD
</pre><ol>
<li>将导出序号减去导出表的起始序号(<code>Base</code>的值)。</li>
<li>将这个值直接对应地址表，就找到了。</li>
</ol>
<p><strong>序号表与名称表是对应的，地址表是靠序号表索引得到的</strong></p>
<h6>重定位表<span class="hx-absolute -hx-mt-20" id="重定位表"></span>
    <a href="#%e9%87%8d%e5%ae%9a%e4%bd%8d%e8%a1%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>如果两个<code>dll</code>文件在导入内存时，导入在相同的<code>ImageBase</code>的偏移处，该怎么办？只需要修正其中一个<code>dll</code>文件的偏移在没有文件导入的内存偏移，即可。但这两个<code>dll</code>中的全局变量的硬编码可能会有相同的偏移。这时就需要使用重定位表了</p>
<p>数据目录项的第6个结构，就是重定位表（相对于映像基址的偏移量）。</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/chongdingxiang.png" alt="image" loading="lazy" /></p>
<p>结构如下：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_BASE_RELOCATION {
</span></span><span style="display:flex;"><span>	DWORD VirtualAddress;
</span></span><span style="display:flex;"><span>	DWORD SizeOfBlock; <span style="color:#75715e">//字节为单位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} IMAGE_BASE_RELOCATION;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<ol>
<li>这个结构体中的第二个成员<code>SizeOfBlock</code>是当前重定位块的总大小，就是加上<code>VirtualAddress</code>成员的大小。</li>
<li>当遇到全为<code>\x00</code>时(<code>8</code>个)，说明已经结束了。</li>
</ol>
<p>比如其中一个重定位块如下：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Virtual</th>
          <th style="text-align: center"></th>
          <th style="text-align: center"></th>
          <th style="text-align: center"></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">Size</td>
          <td style="text-align: center"></td>
          <td style="text-align: center"></td>
          <td style="text-align: center"></td>
      </tr>
      <tr>
          <td style="text-align: center">0011####</td>
          <td style="text-align: center">########</td>
          <td style="text-align: center">0011####</td>
          <td style="text-align: center">########</td>
      </tr>
      <tr>
          <td style="text-align: center">0011####</td>
          <td style="text-align: center">########</td>
          <td style="text-align: center">0011####</td>
          <td style="text-align: center">########</td>
      </tr>
  </tbody>
</table>
<p>说明：<code>Virtual</code>代表<code>VirtualAddress</code>成员，<code>Size(0x10)</code>代表<code>SizeOfBlock</code>成员，<code>#</code>代表一位的数据，一个框代表一个字节。<code>2^12=4096</code>，即为一页对齐的数据，所以使用两个字节(<code>16</code>位其中的低<code>12</code>位)来存放地址，其中的高4位的作用是：当高4位的值为3(0011=3，不是3时就是垃圾！)时，说明该地址有意义重定位，应当<code>重定位的值=VirtualAddress成员+低12位</code></p>
<h6>移动导出表，重定向表<span class="hx-absolute -hx-mt-20" id="移动导出表重定向表"></span>
    <a href="#%e7%a7%bb%e5%8a%a8%e5%af%bc%e5%87%ba%e8%a1%a8%e9%87%8d%e5%ae%9a%e5%90%91%e8%a1%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ol>
<li>在<code>DLL</code>中新增一个节，并返回新增后的<code>FOA</code></li>
<li>复制<code>AddressOfFunctions</code>	长度：<code>4*NumberOfFunctions</code></li>
<li>复制<code>AddressOfNameOrdinals</code>	长度：<code>NumberOfNames*2</code></li>
<li>复制<code>AddressOfNames</code>	长度：<code>NumberOfNames*4</code></li>
<li>复制所有的函数名	长度不确定，复制时直接修复<code>AddressOfNames</code></li>
<li>复制<code>IMAGE_EXPORT_DIRECTORY</code>结构</li>
<li>修复<code>IMAGE_EXPORT_DIRECTORY</code>结构中的	<code>AddressOfFunctions</code>	<code>AddressOfNameOrdinals</code>	<code>AddressOfNames</code></li>
<li>修复目录项中的值，指向新的<code>IMAGE_EXPORT_DIRECTORY</code></li>
</ol>
<h6>导入表<span class="hx-absolute -hx-mt-20" id="导入表"></span>
    <a href="#%e5%af%bc%e5%85%a5%e8%a1%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>导入表就像程序的“借用清单”，告诉它运行时需要调用哪些外部函数以及从哪里找到它们。</p>
<ol>
<li>依赖一个模块就会有一个导入表，所以导入表有很多。</li>
<li>遇到连续<code>20</code>个<code>\x00</code>说明导入表结束了</li>
</ol>
<p>结构如下：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> struct_IMAGE_IMPORT_DESCRIPTOR 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">union</span> {
</span></span><span style="display:flex;"><span>DWORD Characteristics;
</span></span><span style="display:flex;"><span>DWORD OriginalFirstThunk;			  <span style="color:#75715e">//RVA指向IMAGE_THUNK_DATA结构数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>DWORD TimeDateStamp;				 <span style="color:#75715e">//时间戳
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>DWORD ForwarderChain;
</span></span><span style="display:flex;"><span>DWORD Name;							 <span style="color:#75715e">//RVA,指向dl名字，该名字已0结尾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>DWORD FirstThunk;					 <span style="color:#75715e">//RVA,指向IMAGE_THUNK_DATA结构数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}IMAGE_IMPORT_DESCRIPTOR;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>其中:</p>
<ol>
<li><code>OriginalFirstThunk</code>成员和<code>FirstThunk</code>成员又分别指向了<code>INT</code>（导入名称表）和<code>IAT</code>（导入地址表），这两张表位置和名称都不同，但内容却相同，都能找到函数名称。</li>
<li>当遇到全为<code>\x00</code>时，说明已经结束了。</li>
<li>成员有多少个，该程序就使用了这个<code>dll</code>中的多少个函数。</li>
</ol>
<p><img src="https://c65mael.github.io/static/myassets-beg/daorubiao1.png" alt="image" loading="lazy" /></p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> struct_IMAGE_THUNK_DATA32
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">union</span>{
</span></span><span style="display:flex;"><span>	PBYTE ForwarderString;
</span></span><span style="display:flex;"><span>	PDWORD Function;
</span></span><span style="display:flex;"><span>	DWORD Ordinal;						<span style="color:#75715e">//序号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	PIMAGE_IMPORT_BY_NAME AddressOfData;  <span style="color:#75715e">//指向IMAGE_IMPORT_BY_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}u1;
</span></span><span style="display:flex;"><span>}IMAGE_THUNK_DATA32;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>在<code>OriginalFirstThunk</code>中的<code>IMAGE_THUNK_DATA32</code>成员。判断最高是否为<code>1</code>，如果是，那么除去最高位的值就是函数的导出序号(按序号导入)；如果不是，那么这个值是一个<code>RVA</code>指向<code>IMAGE_IMPORT_BY_NAME</code></p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> struct_IMAGE_IMPORT_BY_NAME {
</span></span><span style="display:flex;"><span>	WORD Hint;							<span style="color:#75715e">//可能为空,编译器决定如果不为空是函数在导出表中的索引
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	BYTE Name[<span style="color:#ae81ff">1</span>];						<span style="color:#75715e">//函数名称，以0结尾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}IMAGE IMPORT BY NAME, <span style="color:#f92672">*</span>PIMAGE IMPORT BY NAME;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p><code>Hint</code>成员如果不为空，则直接找导出表中地址表的索引，直接可以找到函数。</p>
<p><code>Hint</code>成员如果为空，则通过<code>Name[1]</code>来确定函数叫说明名字，之所以是<code>1</code>字节，是因为函数不知道函数名称的长度，所以确定第一个字节之后一直找，遇到<code>\x00</code>结束，就是函数的名称。</p>
<p>确定函数地址：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/daorubiao2.png" alt="image" loading="lazy" /></p>
<ol>
<li>在使用其他<code>dll</code>中的函数，使用的<code>call</code>都是间接<code>call</code>。间接<code>call</code>会提供一个地址编号来存放函数的地址，那么这个地址所在的表就是导入地址表(<code>IAT</code>)。</li>
<li><code>PE</code>文件加载前后<code>IAT</code>表会发生变化，会存放函数的地址(也就是通过函数的名称进而得到函数的地址)。</li>
<li>为什么有两条线？如果<code>IAT</code>表的这条线被破坏，则可以通过<code>INT</code>表进行修正。</li>
</ol>
<h6>绑定导入表<span class="hx-absolute -hx-mt-20" id="绑定导入表"></span>
    <a href="#%e7%bb%91%e5%ae%9a%e5%af%bc%e5%85%a5%e8%a1%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>在系统自提供的<code>.exe</code>程序中，可以发现<code>IAT</code>表里面是一个地址，并且和<code>INT</code>表的值不同。这个情况其实可以等价于<code>PE</code>文件加载后的状态，可以提高程序的执行速度。</p>
<ul>
<li>
<p><code>PE</code>加载<code>EXE</code>相关的<code>DLL</code>时，首先会根据<code>IMAGE_IMPORT_DESCRIPTOR</code>结构中的<code>TimeDateStamp</code>来判断是否要重新计算<code>IAT</code>表中的地址。</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">TimeDateStamp</th>
          <th style="text-align: center">状态</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">0</td>
          <td style="text-align: center">未绑定</td>
      </tr>
      <tr>
          <td style="text-align: center">1</td>
          <td style="text-align: center">已绑定（真正的绑定时间为<code>IMAGE_BOUND_IMPORT_DESCRIPTOR</code>的<code>TimeDateStamp</code>）</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>结构如下：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_BOUND_IMPORT_DESCRIPTOR {
</span></span><span style="display:flex;"><span>    DWORD   TimeDateStamp;
</span></span><span style="display:flex;"><span>    WORD    OffsetModuleName;
</span></span><span style="display:flex;"><span>    WORD    NumberOfModuleForwarderRefs;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Array of zero or more IMAGE_BOUND_FORWARDER_REF follows
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} IMAGE_BOUND_IMPORT_DESCRIPTOR,  <span style="color:#f92672">*</span>PIMAGE_BOUND_IMPORT_DESCRIPTOR;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_BOUND_FORWARDER_REF {
</span></span><span style="display:flex;"><span>    DWORD   TimeDateStamp;
</span></span><span style="display:flex;"><span>    WORD    OffsetModuleName;
</span></span><span style="display:flex;"><span>    WORD    Reserved;
</span></span><span style="display:flex;"><span>} IMAGE_BOUND_FORWARDER_REF, <span style="color:#f92672">*</span>PIMAGE_BOUND_FORWARDER_REF;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>注意：对应<code>dll</code>的名称是<code>第一个_IMAGE_BOUND_IMPORT_DESCRIPTOR的地址 + 对应的OffsetModuleName</code></p>
</li>
<li>
<p>当<code>IMAGE_BOUND_IMPORT_DESCRIPTOR</code>结构中的<code>TimeDateStamp</code>与<code>DLL</code>文件标准<code>PE</code>头中的<code>TimeDateStamp</code>值不相符时，或者<code>DLL</code>需要重新定位的时候，就会重新计算<code>IAT</code>中的值</p>
</li>
</ul>
<h6>注入入门<span class="hx-absolute -hx-mt-20" id="注入入门"></span>
    <a href="#%e6%b3%a8%e5%85%a5%e5%85%a5%e9%97%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>当<code>Exe</code>被加载时，系统会根据<code>Exe</code>导入表信息来加载需要用到的<code>DLL</code>，导入表注入的原理就是修改<code>exe</code>导入表，将自己的<code>DLL</code>添加到<code>exe</code>的导入表中，这样<code>exe</code>运行时可以将自己的<code>DLL</code>加载到<code>exe</code>的进程空间。</p>
<ul>
<li>
<p>注入的种类：</p>
<ol>
<li>注册表注入</li>
<li>导入表注入</li>
<li>特洛伊注入</li>
<li>远程线程注入</li>
<li>无<code>DLL</code>注入</li>
<li><code>Apc</code>注入</li>
<li><code>Windows</code>挂钩注入<code>DLL</code></li>
<li>输入法注入</li>
</ol>
</li>
<li>
<p>导入表注入的实现步骤：</p>
<ol>
<li>
<p>根据目录项（第二个就是导入表）得到导入表信息：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_DATA_DIRECTORY {
</span></span><span style="display:flex;"><span>    DWORD   VirtualAddress;
</span></span><span style="display:flex;"><span>    DWORD   Size;
</span></span><span style="display:flex;"><span>} IMAGE_DATA_DIRECTORY, <span style="color:#f92672">*</span>PIMAGE_DATA_DIRECTORY;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//VirtualAddress :指向导入表结构
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//Size:导入表的总大小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//这两个值都需要
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> _IMAGE_IMPORT_DESCRIPTOR {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">union</span> {
</span></span><span style="display:flex;"><span>        DWORD   Characteristics;
</span></span><span style="display:flex;"><span>        DWORD   OriginalFirstThunk;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    DWORD   TimeDateStamp;
</span></span><span style="display:flex;"><span>    DWORD   ForwarderChain;
</span></span><span style="display:flex;"><span>    DWORD   Name;
</span></span><span style="display:flex;"><span>    DWORD   FirstThunk;
</span></span><span style="display:flex;"><span>} IMAGE_IMPORT_DESCRIPTOR;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> IMAGE_IMPORT_DESCRIPTOR UNALIGNED <span style="color:#f92672">*</span>PIMAGE_IMPORT_DESCRIPTOR;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p><img src="https://c65mael.github.io/static/myassets-beg/daorubiaozhuru.png" alt="image" loading="lazy" /></p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>新增一个导入表需要的空间：
A:20字节
B:16字节		
C:取决于DLL名串的长度&#43;1
D:取决于函数名的长度&#43;1&#43;2</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>判断哪一个节的空白区 &gt; Size(原导入表的大小) &#43; 20 &#43; A &#43; B &#43; C &#43; D
如果空间不够：可以将C/D 存储在其他的空白区也就是，只要空白区 &gt; Size &#43; 0x20就可以了
如果仍然不够，就需要扩大最后一个节，或者新增节来解决.</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>将原导入表全部<code>Copy</code>到空白区</p>
</li>
<li>
<p>在新的导入表后面，追加一个导入表</p>
</li>
<li>
<p>追加<code>8</code>个字节的<code>INT</code>表和 <code>8</code>个字节的<code>IAT</code>表</p>
</li>
<li>
<p>追加一个<code>IMAGE_IMPORT_BY_NAME</code>结构，前<code>2</code>个字节是<code>0</code>后面是函数名称字符串</p>
</li>
<li>
<p>将<code>IMAGE_IMPORT_BY_NAME</code>结构的<code>RVA</code>赋值给<code>INT</code>和<code>IAT</code>表中的第一项</p>
</li>
<li>
<p>分配空间存储<code>DLL</code>名称字符串 并将该字符串的<code>RVA</code>赋值给<code>Name</code>属性</p>
</li>
<li>
<p>修正<code>IMAGE_DATA_DIRECTORY</code>结构的<code>VirtualAddress</code>和<code>Size</code></p>
</li>
</ol>
</li>
</ul>
<h3>win32<span class="hx-absolute -hx-mt-20" id="win32"></span>
    <a href="#win32" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><h6>宽字符<span class="hx-absolute -hx-mt-20" id="宽字符"></span>
    <a href="#%e5%ae%bd%e5%ad%97%e7%ac%a6" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>概述：</p>
<p><code>ASCII</code>编码无法满足我们输入的中文文字。便引入了扩展<code>ASCII</code>表，原来的<code>ASCII</code>表进行扩展，将<code>0x80~0xff</code>的两个符号拼起来组成新的文字(<code>GB2312</code>)，就可以显示中文了。但是不同国家有不同的规则，那么中文文字发送过去会产生乱码。为了解决这个问题，就产生了<code>Unicode</code>编码，<code>unicode</code>编码是将世界上所有的字符建立与<code>0~0x10ffff</code>的对应。但是<code>Unicode</code>编码长度可能的<code>1</code>或<code>2</code>或<code>3</code>字节，这样不好存储。</p>
</li>
<li>
<p><code>UTF-16</code>:</p>
<p><code>UTF-16</code>编码以<code>16</code>位无符号整数为单位，注意是<code>16</code>位为一个单位，不表示一个字符就只有<code>16</code>位。这个要看字符的<code>Unicode</code>编码处于什么范围而定，有可能是<code>2</code>个字节，也可能是<code>4</code>个字节现在机器上的<code>Unicode</code>编码一般指的就是<code>UTF-16</code>。</p>
</li>
<li>
<p><code>UTF-8</code>:</p>
<p>不同的<code>16</code>进制码用不同的<code>UTF-8</code>规则编码</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Unicode编码(6进制)</th>
          <th style="text-align: center">UTF-8 字节流(二进制)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">000000 - 00007F</td>
          <td style="text-align: center">0xxxxxxx</td>
      </tr>
      <tr>
          <td style="text-align: center">000080 - 0007FF</td>
          <td style="text-align: center">110xxxxx  10xxxxxx</td>
      </tr>
      <tr>
          <td style="text-align: center">000800 - 00FFFF</td>
          <td style="text-align: center">1110xxxx 10xxxxxx  10xxxxxx</td>
      </tr>
      <tr>
          <td style="text-align: center">010000 -10FFFF</td>
          <td style="text-align: center">11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p><code>BOM</code>（<code>Byte Order Mark</code>）:</p>
<p>放在<code>UTF-8</code>或<code>UTF-16</code>编码的前面，让计算机知道这是什么方式编码的</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">BOM</th>
          <th style="text-align: center"></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">UTF-8</td>
          <td style="text-align: center">EF BB BF</td>
      </tr>
      <tr>
          <td style="text-align: center">UTF-16LE(小端)</td>
          <td style="text-align: center">FF FE</td>
      </tr>
      <tr>
          <td style="text-align: center">UTF-16BE(大端)</td>
          <td style="text-align: center">FE FF</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p><code>c</code>语言中的宽字节：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> szStr[]<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;中国&#34;</span>;				<span style="color:#75715e">//2D 4E FD 56 00			(GB2312编码)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">wchar_t</span> swzStr]<span style="color:#f92672">=</span><span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;中国&#34;</span>;			<span style="color:#75715e">//D6 D0 B9 FA 00 00		(Unicode编码)宽字节
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>注意：宽字符是以<code>00 00</code>为终止符的。</p>
</li>
<li>
<p><code>win32 api</code>中的宽字节：</p>
<ul>
<li>在<code>win32</code>编程中都是见过的类型，只不过是换了一个名字而已。</li>
<li><code>Windows</code>提供的<code>API</code>凡是需要传递字符串参数的函数，都会提供两个版本和一个宏（比如：<code>MessageboxA</code> <code>MessageboxW</code>），为了使<code>ASCII</code>编码和<code>Unicode</code>编码有区分。</li>
</ul>
<table>
  <thead>
      <tr>
          <th style="text-align: center">字符类型</th>
          <th style="text-align: center">字符串指针</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><code>char，CHAR</code></td>
          <td style="text-align: center"><code>PTSTR(LPTSTR)</code>指向多字节字符串</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>wchar_t，WCHAR</code></td>
          <td style="text-align: center"><code>PTSTR(LPTSTR)</code>指向宽字符串</td>
      </tr>
      <tr>
          <td style="text-align: center">宏   <code>TCHAR</code></td>
          <td style="text-align: center">宏  <code>PTSTR(LPTSTR)</code></td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>为字符串指针赋值：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>PSTR pszChar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;china&#34;</span>;			<span style="color:#75715e">//多字节字符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PWSTR pszWChar <span style="color:#f92672">=</span> <span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;china&#34;</span>;		<span style="color:#75715e">//宽字符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PTSTR pszTChar <span style="color:#f92672">=</span> TEXT(<span style="color:#e6db74">&#34;china&#34;</span>);	<span style="color:#75715e">//如果项目是ASCII的，相当于&#34;china&#34;；如果项目是UNICODE，相当于L&#34;china&#34;
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>字符数组赋值：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>CHAR cha[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;中国&#34;</span>;
</span></span><span style="display:flex;"><span>WCHAR chw[] <span style="color:#f92672">=</span> <span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;中国&#34;</span>;
</span></span><span style="display:flex;"><span>TCHAR cht[] <span style="color:#f92672">=</span> TEXT(<span style="color:#e6db74">&#34;中国&#34;</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>函数的不同：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">普通</th>
          <th style="text-align: center">宽字符</th>
          <th style="text-align: center">功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><code>printf</code></td>
          <td style="text-align: center"><code>wprintf</code></td>
          <td style="text-align: center">打印到控制台函数</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>strlen</code></td>
          <td style="text-align: center"><code>wcslen</code></td>
          <td style="text-align: center">获取长度</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>strcpy</code></td>
          <td style="text-align: center"><code>wcscpy</code></td>
          <td style="text-align: center">字符串复制</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>strcat</code></td>
          <td style="text-align: center"><code>wcscat</code></td>
          <td style="text-align: center">字符串拼接</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>strcmp</code></td>
          <td style="text-align: center"><code>wcscmp</code></td>
          <td style="text-align: center">字符串比较</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>strstr</code></td>
          <td style="text-align: center"><code>wcsstr</code></td>
          <td style="text-align: center">字符串查找</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>char</code></td>
          <td style="text-align: center"><code>wchar_t</code></td>
          <td style="text-align: center">多字节字符类型   宽字符类型</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>调试函数：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">OutputDebugStringF</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>format, ...);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ifdef _DEBUG
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DbgPrintf   OutputDebugStringF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DbgPrintf
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//.cpp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">OutputDebugStringF</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>format, ...)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    va_list vlArgs;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span>    <span style="color:#f92672">*</span>strBuffer <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)GlobalAlloc(GPTR, <span style="color:#ae81ff">4096</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    va_start(vlArgs, format);
</span></span><span style="display:flex;"><span>    _vsnprintf(strBuffer, <span style="color:#ae81ff">4096</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, format, vlArgs);
</span></span><span style="display:flex;"><span>    va_end(vlArgs);
</span></span><span style="display:flex;"><span>    strcat(strBuffer, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    OutputDebugStringA(strBuffer);
</span></span><span style="display:flex;"><span>    GlobalFree(strBuffer);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>事件-消息<span class="hx-absolute -hx-mt-20" id="事件-消息"></span>
    <a href="#%e4%ba%8b%e4%bb%b6-%e6%b6%88%e6%81%af" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p><code>Windows</code>中的事件是一个“动作”，这个动作可能是用户操作应用程序产生的，也可能是<code>Windows</code>自己产生的。而消息，就是用来描述这些“动作”的，比如：这个动作是什么时候产生的？哪个应用程序产生的？在什么位置产生的？等等……</p>
</li>
<li>
<p><code>Windows</code>为了能够准确的描述这些信息，提供了一个结构体：<code>MSG</code>，该结构体里面记录的事件的详细信息</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">tagMSG</span> {
</span></span><span style="display:flex;"><span>  HWND   hwnd;    <span style="color:#75715e">//表示消息所属的窗口，一个消息一般都是与某个窗口相关联的，在Windows中HWND类型的变量通常用来标识窗口。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  UINT   message;    <span style="color:#75715e">//在Windows中，消息是由一个数值来表示的，但是由于数值不便于记忆，所以Windows将消息对应的数值定义为WM_XXX宏（WM == Window Message）比如：鼠标左键按下-&gt;WM_LBUTTONDOWN    键盘按下-&gt;WM_KEYDOWN
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  WPARAM wParam;    <span style="color:#75715e">//32位消息的特定附加信息,具体表示什么处决于message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPARAM lParam;    <span style="color:#75715e">//与上一个一样
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  DWORD  time;    <span style="color:#75715e">//消息创建时的时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  POINT  pt;    <span style="color:#75715e">//消息创建时的鼠标位置(x轴与y轴)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} MSG, <span style="color:#f92672">*</span>PMSG;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>完整的一个消息流程</p>
<pre class="mermaid hx-mt-6">
  graph TB
    A[系统/用户触发的某个动作--&gt;事件] --&gt; B[系统将这些信息存储到MSG结构体中--&gt;消息];
    B --&gt; C[系统将该消息存储到相关应用程序的消息队列中--&gt;消息队列];
    C --&gt; D[循环开始--&gt;从队列中循环获取消息];
    D --&gt; H{GetMessage（&amp;Msg,NULL,0,0）?};
    H -- 是 (Yes) --&gt; I[TranslateMessage（&amp;Msg）//翻译消息];
    I --&gt; J[DispatchMessage（&amp;Msg）//派发消息];
    J --&gt; D;
    H -- 否 (No) --&gt; K[循环结束];

    K --&gt; E[DispatchMessage将加工过的消息传递给操作系统];
    E --&gt; F[系统调用窗口过程函数];
    F --&gt; G{WindowProc函数  //窗口过程函数};
</pre><p>系统消息队列与应用程序消息队列：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/xiaoxi1.png" alt="image" loading="lazy" /></p>
<p>其实整体的过程就是从消息队列中取出消息，判断消息是不是我关系的消息。如果是就处理消息；如果不是就让系统去处理消息</p>
</li>
</ul>
<h6>子窗口-消息处理函数<span class="hx-absolute -hx-mt-20" id="子窗口-消息处理函数"></span>
    <a href="#%e5%ad%90%e7%aa%97%e5%8f%a3-%e6%b6%88%e6%81%af%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>按钮事件的处理：</p>
<p>按钮的<code>WNDCLASS</code>不是我们定义的，是系统预定义好的。</p>
</li>
<li>
<p>回调函数的结构</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(
</span></span><span style="display:flex;"><span>	IN  HWND hwnd,
</span></span><span style="display:flex;"><span>	IN  UINT uMsg,
</span></span><span style="display:flex;"><span>	IN  WPARAM wParam,
</span></span><span style="display:flex;"><span>	IN  LPARAM lParam
</span></span><span style="display:flex;"><span>	);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>回调函数的堆栈</p>
<pre class="mermaid hx-mt-6">
  erDiagram
	stack {
        ESP return_address
        ESP_4 hwnd
        ESP_8 uMsg
        ESP_c wParam
        ESP_10 lParam
    }
</pre></li>
<li>
<p>总结：</p>
<ol>
<li>
<p>按钮是一种特殊的窗体，并不需要提供单独的窗口回调函数</p>
</li>
<li>
<p>当按钮有事件产生时，会给父窗口消息处理程序发送一个<code>WM_COMMAND</code>消息</p>
<pre class="mermaid hx-mt-6">
  graph TB
    A[按钮] --单击按钮--&gt; B[系统提供WinProc];
    B --转换WM_COMMAND--&gt; C[父窗口的WinProc];
</pre></li>
</ol>
</li>
</ul>
<h6>资源表（PE）<span class="hx-absolute -hx-mt-20" id="资源表pe"></span>
    <a href="#%e8%b5%84%e6%ba%90%e8%a1%a8pe" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p><img src="https://c65mael.github.io/static/myassets-beg/ziyuan.png" alt="image" loading="lazy" /></p>
<ul>
<li>
<p>资源目录（图中绿色的）：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_IMAGE_RESOURCE_DIRECTORY</span> {
</span></span><span style="display:flex;"><span>    DWORD   Characteristics;						<span style="color:#75715e">//资源属性  保留 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   TimeDateStamp;							<span style="color:#75715e">//资源创建的时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    MajorVersion;							<span style="color:#75715e">//资源版本号 未使用 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    MinorVersion;							<span style="color:#75715e">//资源版本号 未使用 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    NumberOfNamedEntries;					<span style="color:#75715e">//以名称命名的资源数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    WORD    NumberOfIdEntries;						<span style="color:#75715e">//以ID命名的资源数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//  IMAGE_RESOURCE_DIRECTORY_ENTRY DirectoryEntries[];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} IMAGE_RESOURCE_DIRECTORY, <span style="color:#f92672">*</span>PIMAGE_RESOURCE_DIRECTORY;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>资源目录项（图中黄色的）：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_IMAGE_RESOURCE_DIRECTORY_ENTRY</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">union</span> {									<span style="color:#75715e">//目录项的名称、或者ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>            DWORD NameOffset:<span style="color:#ae81ff">31</span>;    <span style="color:#75715e">//低31位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            DWORD NameIsString:<span style="color:#ae81ff">1</span>;    <span style="color:#75715e">//最高1位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        };
</span></span><span style="display:flex;"><span>        DWORD   Name;    <span style="color:#75715e">//在第一层中代表光标，位图等16种预定义类型。而在第二层代表资源编号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        WORD    Id;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">union</span> {
</span></span><span style="display:flex;"><span>        DWORD   OffsetToData;				<span style="color:#75715e">//目录项指针
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>            DWORD   OffsetToDirectory:<span style="color:#ae81ff">31</span>;
</span></span><span style="display:flex;"><span>            DWORD   DataIsDirectory:<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>} IMAGE_RESOURCE_DIRECTORY_ENTRY, <span style="color:#f92672">*</span>PIMAGE_RESOURCE_DIRECTORY_ENTRY;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<ul>
<li>
<p><code>OffsetToData</code>的含义：</p>
<ol>
<li>最高位如果为<code>1</code>：<code>低31位 + 资源地址 == 下一层目录节点的起始位置</code></li>
<li>最高位如果为<code>0</code>，指向<code>IMAGE_RESOURCE_DATA_ENTRY</code></li>
<li>第一层、第二层全为<code>1</code>，第三层为<code>0</code></li>
</ol>
</li>
<li>
<p>在<code>Name</code>的<code>union</code>中</p>
<ul>
<li>
<p>当最高位是<code>1</code>时，低<code>31</code>位是一个<code>UNICODE</code>指针，指向一个结构：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_IMAGE_RESOURCE_DIR_STRING_U</span> {
</span></span><span style="display:flex;"><span>    WORD    Length;
</span></span><span style="display:flex;"><span>    WCHAR   NameString[ <span style="color:#ae81ff">1</span> ];
</span></span><span style="display:flex;"><span>} IMAGE_RESOURCE_DIR_STRING_U, <span style="color:#f92672">*</span>PIMAGE_RESOURCE_DIR_STRING_U;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>当最高位是<code>0</code>时，表示字段的值作为<code>ID</code>使用</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>数据项（图中橙色的）：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_IMAGE_DATA_DIRECTORY</span> {
</span></span><span style="display:flex;"><span>    DWORD   VirtualAddress;
</span></span><span style="display:flex;"><span>    DWORD   Size;
</span></span><span style="display:flex;"><span>} IMAGE_DATA_DIRECTORY, <span style="color:#f92672">*</span>PIMAGE_DATA_DIRECTORY;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>其中，简体中文：<code>2052</code></p>
</li>
</ul>
<h6>WM_NOTIFY<span class="hx-absolute -hx-mt-20" id="wm_notify"></span>
    <a href="#wm_notify" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>概述：</p>
<ol>
<li>该消息类型与<code>WM_COMMAND</code>类型相似，都是由子窗口向父窗口发送的消息。</li>
<li><code>WM_NOTIFY</code>可以包含比<code>WM_COMMAND</code>更丰富的信息。</li>
<li><code>Windows</code>通用组件中有很多消息，都是通过<code>WM_NOTIFY</code>来描述的。</li>
</ol>
</li>
<li>
<p><code>WM_NOTIFY</code>消息中的参数如下：</p>
<p><code>wParam</code>：控件<code>ID</code></p>
<p><code>lParam</code>：指向一个结构：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">tagNMHDR</span> {
</span></span><span style="display:flex;"><span>        HWND hwndFrom; <span style="color:#75715e">//发送通知消息的控制窗口句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        UINT idFrom;   <span style="color:#75715e">//发送通知消息的控制ID值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        UINT code;     <span style="color:#75715e">//通知码，如LVM_SELCHANGED
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    } NMHDR;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>这个结构体能满足一般的要求，但能描述的信息还是有限的</p>
<p>解决方案：对每种不同用途的通知消息都定义另一种结构来表示</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">tagNMLVCACHEHINT</span> {
</span></span><span style="display:flex;"><span>    NMHDR   hdr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span>     iFrom;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span>     iTo;
</span></span><span style="display:flex;"><span>} NMLVCACHEHINT, <span style="color:#f92672">*</span>PNMLVCACHEHINT;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">tagLVDISPINFO</span> {
</span></span><span style="display:flex;"><span>    NMHDR hdr;
</span></span><span style="display:flex;"><span>    LVITEM item;
</span></span><span style="display:flex;"><span>} NMLVDISPINFO, FAR <span style="color:#f92672">*</span>LPNMLVDISPINFO;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_NMLVFINDITEM</span> {
</span></span><span style="display:flex;"><span>    NMHDR hdr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> iStart;
</span></span><span style="display:flex;"><span>    LVFINDINFO lvfi;
</span></span><span style="display:flex;"><span>} NMLVFINDITEM, <span style="color:#f92672">*</span>PNMLVFINDITEM;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>线程<span class="hx-absolute -hx-mt-20" id="线程"></span>
    <a href="#%e7%ba%bf%e7%a8%8b" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>线程是由<code>Windows</code>内核负责创建与管理的，句柄相当于一个令牌，有了这个令牌就可以使用线程对象。</p>
<p>线程<code>ID</code>是身份证，唯一的，系统进行线程调度的时候要使用的</p>
</li>
<li>
<p>创建线程：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE <span style="color:#a6e22e">CreateThread</span>(
</span></span><span style="display:flex;"><span>  LPSECURITY_ATTRIBUTES lpThreadAttributes, <span style="color:#75715e">// 安全属性 通常为NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  SIZE_T dwStackSize,                       <span style="color:#75715e">// 参数用于设定线程可以将多少地址空间用于它自己的堆栈，每个线程拥有它自己的堆栈
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPTHREAD_START_ROUTINE lpStartAddress,    <span style="color:#75715e">// 参数用于指明想要新线程执行的线程函数的地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPVOID lpParameter,                       <span style="color:#75715e">// 线程函数的参数，在线程启动执行时将该参数传递给线程函数。既可以是数字，也可以是指向包含其他信息的一个数据结构的指针
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  DWORD dwCreationFlags,                    <span style="color:#75715e">// 0 创建完毕立即调度  CREATE_SUSPENDED创建后挂起
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPDWORD lpThreadId                        <span style="color:#75715e">// 线程ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span>				        					<span style="color:#75715e">// 返回值：线程句柄
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>创建线程代码：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>DWORD WINAPI <span style="color:#a6e22e">ThreadProc</span>(
</span></span><span style="display:flex;"><span>		     LPVOID lpParameter   <span style="color:#75715e">// thread data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		     )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//创建一个新的线程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>HANDLE hThread <span style="color:#f92672">=</span> <span style="color:#f92672">::</span>CreateThread(NULL, <span style="color:#ae81ff">0</span>, ThreadProc,NULL, <span style="color:#ae81ff">0</span>, NULL);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//如果不在其他的地方引用它 关闭句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">::</span>CloseHandle(hThread);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>向线程函数传递变量的两种方式：</p>
<ol>
<li>全局变量</li>
<li>线程参数</li>
</ol>
</li>
</ul>
<h6>线程控制<span class="hx-absolute -hx-mt-20" id="线程控制"></span>
    <a href="#%e7%ba%bf%e7%a8%8b%e6%8e%a7%e5%88%b6" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>每个线程在执行的时候，都会独自占用一个<code>CPU</code>，当系统中的<code>线程数量 &gt; CPU的数量</code>时，就会存在多个线程共用一个<code>CPU</code>的情况。但<code>CPU</code>每次只能运行一个线程，<code>Windows</code>每隔<code>20</code>毫秒会进行线程的切换，那比如线程A执行到地址：<code>0x2345678 eax:1 ecx:2 edx:3 ebx:4...</code>还有<code>eflag</code>标志寄存器中的值等等&hellip;
此时，线程执行时间到了，被切换到了线程<code>B...</code>当线程<code>B</code>的时间片也到了，再切换会线程<code>A</code>时，系统是如何知道该从哪个地址开始执行呢？被切换前用到的各种寄存器的值该如何恢复呢？</p>
</li>
<li>
<p>有一个<code>struct _CONTEXT</code>结构，该结构包含了特定处理器的寄存器数据。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_CONTEXT</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// The flags values within this flag control the contents of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// a CONTEXT record.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// If the context record is used as an input parameter, then
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// for each portion of the context record controlled by a flag
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// whose value is set, it is assumed that that portion of the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// context record contains valid context. If the context record
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// is being used to modify a threads context, then only that
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// portion of the threads context will be modified.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// If the context record is used as an IN OUT parameter to capture
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// the context of a thread, then only those portions of the thread&#39;s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// context corresponding to set flags will be returned.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// The context record is never used as an OUT only parameter.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD ContextFlags;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This section is specified/returned if CONTEXT_DEBUG_REGISTERS is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// set in ContextFlags.  Note that CONTEXT_DEBUG_REGISTERS is NOT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// included in CONTEXT_FULL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   Dr0;
</span></span><span style="display:flex;"><span>    DWORD   Dr1;
</span></span><span style="display:flex;"><span>    DWORD   Dr2;
</span></span><span style="display:flex;"><span>    DWORD   Dr3;
</span></span><span style="display:flex;"><span>    DWORD   Dr6;
</span></span><span style="display:flex;"><span>    DWORD   Dr7;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This section is specified/returned if the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ContextFlags word contians the flag CONTEXT_FLOATING_POINT.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    FLOATING_SAVE_AREA FloatSave;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This section is specified/returned if the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ContextFlags word contians the flag CONTEXT_SEGMENTS.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   SegGs;
</span></span><span style="display:flex;"><span>    DWORD   SegFs;
</span></span><span style="display:flex;"><span>    DWORD   SegEs;
</span></span><span style="display:flex;"><span>    DWORD   SegDs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This section is specified/returned if the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ContextFlags word contians the flag CONTEXT_INTEGER.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   Edi;
</span></span><span style="display:flex;"><span>    DWORD   Esi;
</span></span><span style="display:flex;"><span>    DWORD   Ebx;
</span></span><span style="display:flex;"><span>    DWORD   Edx;
</span></span><span style="display:flex;"><span>    DWORD   Ecx;
</span></span><span style="display:flex;"><span>    DWORD   Eax;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This section is specified/returned if the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ContextFlags word contians the flag CONTEXT_CONTROL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    DWORD   Ebp;
</span></span><span style="display:flex;"><span>    DWORD   Eip;
</span></span><span style="display:flex;"><span>    DWORD   SegCs;              <span style="color:#75715e">// MUST BE SANITIZED
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   EFlags;             <span style="color:#75715e">// MUST BE SANITIZED
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD   Esp;
</span></span><span style="display:flex;"><span>    DWORD   SegSs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This section is specified/returned if the ContextFlags word
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// contains the flag CONTEXT_EXTENDED_REGISTERS.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// The format and contexts are processor specific
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    BYTE    ExtendedRegisters[MAXIMUM_SUPPORTED_EXTENSION];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>} CONTEXT;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>获取线程<code>CONTEXT</code>结构：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//挂起线程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SuspendThread(<span style="color:#960050;background-color:#1e0010">线程句柄</span>);
</span></span><span style="display:flex;"><span>CONTEXT context
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//设置要获取的类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>context.ContextFlags <span style="color:#f92672">=</span> CONTEXT_CONTROL;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//获取					
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>BOOL ok <span style="color:#f92672">=</span> <span style="color:#f92672">::</span>GetThreadContext(hThread,<span style="color:#f92672">&amp;</span>context);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//设置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>context.Eip <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x401000</span>;
</span></span><span style="display:flex;"><span>SetThreadContext(hThread,<span style="color:#f92672">&amp;</span>context);					
</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>函数：</p>
<ul>
<li>
<p>挂起线程：<code>::SuspendThread(hThread);</code></p>
</li>
<li>
<p>恢复线程：<code>::ResumeThread(hThread);</code></p>
</li>
<li>
<p>终止线程：</p>
<ol>
<li>
<p><code>::ExitThread(DWORD dwExitCode);</code></p>
</li>
<li>
<p>线程函数返回</p>
</li>
<li>
<p><code>::TerminateThread(hThread,2);</code></p>
<p><code>::WaitForSingleObject(hThread,INFINITE);</code></p>
</li>
</ol>
</li>
<li>
<p><code>ExitThread</code>与<code>TerminateThread</code>的区别</p>
<ul>
<li><code>::ExitThread(DWORD dwExitCode);</code>是同步调用，就是执行到它就退出，之后的代码就不会执行了；<code>::TerminateThread(hThread,2);</code>是异步调用，后面需要<code>::WaitForSingleObject(hThread,INFINITE);</code>来判断它是否退出了。</li>
<li><code>ExitThread</code>执行完后释放堆栈，而<code>TerminateThread</code>执行不会释放堆栈。</li>
</ul>
</li>
<li>
<p>判断线程是否结束</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>BOOL <span style="color:#a6e22e">GetExitCodeThread</span>(
</span></span><span style="display:flex;"><span>  HANDLE hThread,    <span style="color:#75715e">//要结束的线程句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPDWORD lpExitCode    <span style="color:#75715e">//指定线程的退出代码。可以通过GetExitCodeThread来查看一个线程的退出代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
</li>
</ul>
<h6>临界区<span class="hx-absolute -hx-mt-20" id="临界区"></span>
    <a href="#%e4%b8%b4%e7%95%8c%e5%8c%ba" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>多线程访问全局变量产生问题的原因：</p>
<p>假设有一个公共的白板，上面写着一个数字，比如 “<code>0</code>”。  现在有两个小朋友，小明和小红，他们都想轮流在这个白板上把数字加 1，并且每个人都要加 <code>10000</code> 次。  我们希望最终白板上的数字是 <code>20000</code>。</p>
<ol>
<li><strong>小明想加 <code>1</code>：</strong> 小明走到白板前，看到上面写着 “<code>0</code>”，心里记住了 “现在是 <code>0</code>”。</li>
<li><strong>小红也想加 <code>1</code>：</strong>  几乎同时，小红也走到白板前，也看到了上面写着 “<code>0</code>”，她也记住了 “现在是 <code>0</code>”。</li>
<li><strong>小明写下新数字：</strong> 小明心算了一下 <code>0 + 1 = 1</code>，然后拿起笔，把白板上的 “<code>0</code>” 擦掉，写上了 “<code>1</code>”。</li>
<li><strong>小红也写下新数字：</strong> 小红也心算了一下 <code>0 + 1 = 1</code> （注意，她看到的是之前的 &ldquo;<code>0</code>&quot;，而不是小明刚写的 &ldquo;<code>1</code>&quot;），然后她也拿起笔，把白板上的 &ldquo;<code>0</code>&rdquo; （如果还没被擦掉）或者 &ldquo;<code>1</code>&rdquo; （如果已经被小明写上了，但是小红没注意到）擦掉，也写上了 &ldquo;<code>1</code>&quot;。</li>
</ol>
<p>总结：</p>
<ol>
<li>多线程访问全局变量时，存在线程安全问题（两个人）</li>
<li>局部变量不存在线程安全问题（两个人心算的结果）</li>
</ol>
</li>
<li>
<p>临界区的设计思路：</p>
<p>在上面的例子中，相当于两个人只能用一支笔在白板上写答案</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/lingjiequ.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>代码实现：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//创建CRITICAL_SECTION：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CRITICAL_SECTION cs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//在使用前进行初始化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>InitializeCriticalSection(<span style="color:#f92672">&amp;</span>cs);					
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//在函数中使用:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>DWORD WINAPI <span style="color:#960050;background-color:#1e0010">线程</span>A(PVOID pvParam)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>      EnterCriticalSection(<span style="color:#f92672">&amp;</span>cs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//对全局遍历X的操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      LeaveCriticalSection(<span style="color:#f92672">&amp;</span>cs);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DWORD WINAPI <span style="color:#960050;background-color:#1e0010">线程</span>B(PVOID pvParam)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>      EnterCriticalSection(<span style="color:#f92672">&amp;</span>g_cs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//对全局遍历X的操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      LeaveCriticalSection(<span style="color:#f92672">&amp;</span>g_cs);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//删除CRITICAL_SECTION
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>VOID <span style="color:#a6e22e">DeleteCriticalSection</span>(PCRITICAL_SECTION pcs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//当线程不再试图访问共享资源时
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p><code>CRITICAL_SECTION</code>结构</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_RTL_CRITICAL_SECTION</span> {
</span></span><span style="display:flex;"><span>    PRTL_CRITICAL_SECTION_DEBUG DebugInfo;
</span></span><span style="display:flex;"><span>    LONG LockCount;    <span style="color:#75715e">//它被初始化为数值 -1,此数值等于或大于 0 时，表示此临界区被占用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    LONG RecursionCount;    <span style="color:#75715e">//此字段包含所有者线程已经获得该临界区的次数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    HANDLE OwningThread;    <span style="color:#75715e">//此字段包含当前占用此临界区的线程的线程标识符,此线程ID与GetCurrentThreadId所返回的 ID 相同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    HANDLE LockSemaphore;
</span></span><span style="display:flex;"><span>    DWORD SpinCount;
</span></span><span style="display:flex;"><span>} RTL_CRITICAL_SECTION, <span style="color:#f92672">*</span>PRTL_CRITICAL_SECTION;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>互斥体<span class="hx-absolute -hx-mt-20" id="互斥体"></span>
    <a href="#%e4%ba%92%e6%96%a5%e4%bd%93" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p><code>WaitForSingleObject</code>函数：</p>
<p>等待函数可使线程自愿进入等待状态，直到一个特定的内核对象变为已通知状态为止。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>DWORD <span style="color:#a6e22e">WaitForSingleObject</span>(
</span></span><span style="display:flex;"><span>  HANDLE hHandle,        <span style="color:#75715e">// 内核对象句柄，可以是进程也可以是线程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  DWORD dwMilliseconds   <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">等待时间，单位是毫秒</span>INFINITE(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#960050;background-color:#1e0010">一直等待</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//返回值：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//WAIT_OBJECT_0(0)		等待对象变为已通知
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//WAIT_TIMEOUT(0x102)	超时
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p><code>WaitForMultipleObjects</code>函数：</p>
<p>同时查看若干个内核对象的已通知状态。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>DWORD <span style="color:#a6e22e">WaitForMultipleObjects</span>(
</span></span><span style="display:flex;"><span>  DWORD nCount,             <span style="color:#75715e">// 要查看内核对象的数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  CONST HANDLE <span style="color:#f92672">*</span>lpHandles,  <span style="color:#75715e">// 内核对象数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  BOOL bWaitAll,            <span style="color:#75715e">// 等到类型  TRUE 等到所有变为已通知  FALSE 只要有一个变为已通知
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  DWORD dwMilliseconds      <span style="color:#75715e">// 超时时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//返回值：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//bWaitAll		为TRUE时，返回WAIT_OBJECT_0(0)代码所以内核对象都变成已通知
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//bWaitAll		为FALSE时，返回最先变成已通知的内核对象在数组中的索引
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//WAIT_TIMEOUT(0x102)			超时
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>说明：</p>
<ol>
<li>内核对象中的每种对象都可以说是处于已通知或未通知的状态之中</li>
<li>这种状态的切换是由<code>Microsoft</code>为每个对象建立的一套规则来决定的</li>
<li>当线程正在运行的时候，线程内核对象处于未通知状态；当线程终止运行的时候，它就变为已通知状态</li>
<li>在内核中就是个<code>BOOL</code>值，运行时<code>FALSE</code>结束<code>TRUE</code></li>
</ol>
</li>
<li>
<p>互斥体与临界区的区别：</p>
<ol>
<li>临界区只能用于单个进程间的线程控制</li>
<li>互斥体可以设定等待超时，但临界区不能</li>
<li>线程意外终结时，<code>Mutex</code>可以避免无限等待</li>
<li><code>Mutex</code>效率没有临界区高</li>
</ol>
</li>
</ul>
<h6>事件<span class="hx-absolute -hx-mt-20" id="事件"></span>
    <a href="#%e4%ba%8b%e4%bb%b6" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>什么是内核对象？</p>
<p>进程、线程、文件、文件映射、事件、互斥体等等</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/nhdx0.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>事件内核对象的创建</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE g_hEvent <span style="color:#f92672">=</span> CreateEvent(NULL, TRUE, FALSE, <span style="color:#e6db74">&#34;XYZ&#34;</span>);
</span></span><span style="display:flex;"><span>HANDLE g_hMutex <span style="color:#f92672">=</span> CreateMutex(NULL,FALSE, <span style="color:#e6db74">&#34;XYZ&#34;</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>事件内核对象的获取</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE <span style="color:#a6e22e">OpenEvent</span>(
</span></span><span style="display:flex;"><span>  DWORD dwDesiredAccess,  <span style="color:#75715e">// access
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  BOOL bInheritHandle,    <span style="color:#75715e">// inheritance option
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPCTSTR lpName          <span style="color:#75715e">// object name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HANDLE g_hEvent <span style="color:#f92672">=</span> OpenEvent(EVENT_ALL_ACCESS, FALSE, <span style="color:#e6db74">&#34;XYZ&#34;</span>);
</span></span><span style="display:flex;"><span>HANDLE g_hMutex <span style="color:#f92672">=</span> OpenMutex(MUTEX_ALL_ACCESS,FALSE, <span style="color:#e6db74">&#34;XYZ&#34;</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>内核对象的销毁</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>BOOL <span style="color:#a6e22e">CloseHandle</span>(HANDLE hobj);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<ol>
<li>当没有其他程序引用时，系统会销毁内核对象（使用数量）</li>
<li>内核对象的生命周期，可能比创建它的对象要长</li>
</ol>
</li>
<li>
<p>事件</p>
<p>是在操作系统中可以被程序用来进行事件通知和同步的 “信号灯”（事件对象）</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE <span style="color:#a6e22e">CreateEvent</span>(
</span></span><span style="display:flex;"><span>  LPSECURITY_ATTRIBUTES lpEventAttributes, <span style="color:#75715e">// 安全属性 NULL时为系统默认
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  BOOL bManualReset,                       <span style="color:#75715e">// TRUE 通过调用ResetEvent将事件对象标记为未通知
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  BOOL bInitialState,                      <span style="color:#75715e">// TRUE 已通知状态  FALSE未通知状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPCTSTR lpName                           <span style="color:#75715e">// 对象名称 以NULL结尾的字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>事件对象的控制</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>BOOL <span style="color:#a6e22e">SetEvent</span>(HANDLE hEvent);				       <span style="color:#75715e">//将对象设置为已通知
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>关闭时间对象句柄</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>CloseHandle();										<span style="color:#75715e">//关闭句柄
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>信号量<span class="hx-absolute -hx-mt-20" id="信号量"></span>
    <a href="#%e4%bf%a1%e5%8f%b7%e9%87%8f" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>创建信号量</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE <span style="color:#a6e22e">CreateSemaphore</span>(
</span></span><span style="display:flex;"><span>  LPSECURITY_ATTRIBUTES lpSemaphoreAttributes,    <span style="color:#75715e">//表示安全控制，一般直接传入NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LONG lInitialCount,    <span style="color:#75715e">//表示初始资源数量。0时不发送信号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LONG lMaximumCount,    <span style="color:#75715e">//表示最大并发数量。lInitialCount&lt;=lMaximumCount
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPCTSTR lpName    <span style="color:#75715e">//表示信号量的名称，传入NULL表示匿名信号量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>打开信号量</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE <span style="color:#a6e22e">OpenSemaphore</span>(
</span></span><span style="display:flex;"><span>  DWORD dwDesiredAccess,    <span style="color:#75715e">//表示访问权限，对一般传入SEMAPHORE_ALL_ACCESS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  BOOL bInheritHandle,    <span style="color:#75715e">//示信号量句柄继承性，一般传入FALSE即可
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPCTSTR lpName    <span style="color:#75715e">//表示名称，不同进程中的各线程可以通过名称来确保它们访问同一个信号量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>递增信号量的当前资源计数</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>BOOL <span style="color:#a6e22e">ReleaseSemaphore</span>(
</span></span><span style="display:flex;"><span>  HANDLE hSemaphore,    <span style="color:#75715e">//信号量的句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LONG lReleaseCount,    <span style="color:#75715e">//表示增加个数，必须大于0且不超过最大资源数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LPLONG lpPreviousCount    <span style="color:#75715e">//返回当前资源数量的原始值，设为NULL表示不需要传出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//注：没有一个函数可以用来查询信标的当前资源数量的值
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>进程<span class="hx-absolute -hx-mt-20" id="进程"></span>
    <a href="#%e8%bf%9b%e7%a8%8b" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>就是运行中的一个程序，进程提供程序所需要的资源，它提供数据和代码，是一种空间的概念</p>
</li>
<li>
<p>进程内存空间的地址划分：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">分区</th>
          <th style="text-align: center">x86 32位的windows</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">空指针赋值区</td>
          <td style="text-align: center">0x00000000 - 0x0000FFFF</td>
      </tr>
      <tr>
          <td style="text-align: center">用户模式区</td>
          <td style="text-align: center">0x00010000 - 0x7FFEFFFF</td>
      </tr>
      <tr>
          <td style="text-align: center">64KB禁入区</td>
          <td style="text-align: center">0x7FFF0000 - 0x7FFFFFFF</td>
      </tr>
      <tr>
          <td style="text-align: center">内核</td>
          <td style="text-align: center">0x80000000 - 0xFFFFFFFF</td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>进程的创建</p>
<pre class="mermaid hx-mt-6">
  graph LR
    A[打开系统] --&gt; B[双击要运行的程序];
    B --&gt; C[EXE开始执行];
</pre><ol>
<li>
<p>任何进程都是别的进程创建的：<code>CreateProcess()</code></p>
</li>
<li>
<p>进程的创建过程</p>
<ol>
<li>当系统启动后，创建一个进程：<code>Explorer.exe</code>也就是桌面进程</li>
<li>当用户双击某一个<code>EXE</code>时，<code>Explorer</code>进程使用<code>CreateProcess</code>函数创建被双击的<code>EXE</code>，也就是说，我们在桌面上双击创建的进程都是<code>Explorer</code>进程的子进程</li>
<li>映射<code>EXE</code>文件（将<code>exe</code>放到内存中）</li>
<li>创建内核对象<code>EPROCESS</code></li>
<li>映射系统<code>DLL</code>（<code>ntdll.dll</code>）</li>
<li>创建线程内核对象<code>ETHREAD</code></li>
<li>系统启动线程</li>
</ol>
<p>​		映射<code>DLL</code>（<code>ntdll.LdrlnitializeThunk</code>）</p>
<p>​		线程开始执行</p>
</li>
</ol>
</li>
<li>
<p><code>CreateProcess</code>的做了什么：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>BOOL CreateProcess(
</span></span><span style="display:flex;"><span>	LPCSTR lpApplicationName,	<span style="color:#75715e">//对象名称
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPSTR lpCommandLine,		<span style="color:#75715e">//命令行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPSECURITY_ATTRIBUTES lpProcessAttributes,	<span style="color:#75715e">//不继承进程句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPSECURITY_ATTRIBUTES lpThreadAttributes,	<span style="color:#75715e">//不继承线程句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	BOOL bInheritHandles,		<span style="color:#75715e">//是否允许继承父进程可继承的对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	DWORD dwCreationFlags,		<span style="color:#75715e">//没有创建标志
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPVOID lpEnvironment,		<span style="color:#75715e">//使用父进程环境变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPCSTR lpCurrentDirectory,	<span style="color:#75715e">//使用父进程自录作为当前目录，可以自己设置目录
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPSTARTUPINFOA lpStartupInfo,	<span style="color:#75715e">//STARTUPINFOW结构体详细信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	LPPROCESS_INFORMATION lpProcessInformation	<span style="color:#75715e">//PROCESS_INFORMATION结构体进程信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    )			
</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<ol>
<li>
<p>创建内核对象</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/neiheduixiang.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>分配<code>4GB</code>的虚拟空间（<code>Windows 32</code>位）</p>
<ol>
<li>将<code>EXE</code>拉伸，存储到指定的位置</li>
<li>遍历<code>EXE</code>导入表，将需要用到的<code>DLL</code>拉伸存储到指定位置，如果位置被占用，换的地方，并通过<code>DLL</code>的重定位表，修复全局遍历</li>
<li><code>DLL</code>如果引用了其他的<code>DLL</code>，则递归第二步</li>
<li>修复<code>EXE/DLL</code>中的<code>IAT</code>表</li>
<li>创建线程、设置线程<code>CONTEXT</code>开始执行</li>
</ol>
</li>
<li>
<p>创建进程的主线程</p>
<p>当进程的空间创建完毕，<code>EXE</code>与导入表中的<code>DLL</code>都正确加载完毕后，会创建一个线程。</p>
<p>当线程得到<code>CPU</code>的时候，程序就正开始指向了，<code>EIP</code>的初始值设定为：<code>ImageBase+OEP</code></p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE <span style="color:#a6e22e">CreateThread</span>(
</span></span><span style="display:flex;"><span>   PSECURITY_ATTRIBUTES psa,
</span></span><span style="display:flex;"><span>   DWORD cbStack,
</span></span><span style="display:flex;"><span>   PTHREAD_START_ROUTINE pfnStartAddr,
</span></span><span style="display:flex;"><span>   PVOID pvParam,
</span></span><span style="display:flex;"><span>   DWORD fdwCreate,
</span></span><span style="display:flex;"><span>   PDWORD pdwThreadID);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>当进程创建成功后，会将进程句柄、主线程句柄、进程<code>ID</code>以及主线程<code>ID</code>存储在：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_PROCESS_INFORMATION</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   HANDLE hProcess;				<span style="color:#75715e">//进程句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   HANDLE hThread;				<span style="color:#75715e">//主线程句柄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   DWORD dwProcessId;			<span style="color:#75715e">//进程ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   DWORD dwThreadId;			<span style="color:#75715e">//线程ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} PROCESS_INFORMATION;</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>也就是，<code>CreateProcess</code>的最后一个<code>OUT</code>参数。</p>
</li>
</ol>
</li>
<li>
<p>终止进程的三种方式：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">/*1、*/</span>VOID　<span style="color:#a6e22e">ExitProcess</span>(UINT fuExitCode)									<span style="color:#75715e">//进程自己调用				
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*2、*/</span>BOOL TerminateProcess(HANDLE hProcess, UINT fuExitCode);			<span style="color:#75715e">//终止其他进程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*3、*/</span>ExitThread														<span style="color:#75715e">//终止进程中的所有线程，进程也会终止
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>获取进程的退出码：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>BOOL <span style="color:#a6e22e">GetExitCodeProcess</span>(HANDLE hProcess,PDWORD pdwExitCode);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>进程终止时相关操作：</p>
<ol>
<li>进程中剩余的所有线程全部终止运行</li>
<li>进程指定的所有用户对象均被释放，所有内核对象均被关闭</li>
<li>进程内核对象的状态变成收到通知的状态</li>
<li>进程内核对象的使用计数递减<code>1</code></li>
</ol>
</li>
</ul>
<h6>句柄表<span class="hx-absolute -hx-mt-20" id="句柄表"></span>
    <a href="#%e5%8f%a5%e6%9f%84%e8%a1%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>什么是内核对象：</p>
<p>像进程、线程、文件、互斥体、事件等在<strong>内核</strong>都有一个对应的<strong>结构体</strong>，这些结构体由内核负责管理。我们管这样的对象叫做内核对象。</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/nhdx.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>一个进程有一个自己的内核对象（<code>EPROCESS</code>），在这一个进程里面还有可能创建其他的内核对象（紫色的），那么如何使用他们呢？可以将对应的内核对象的地址传回去就可以了，但是在用户层访问内核层的问题在于，如果这个内核对象的地址被修改，那么访问对应内核层的地址时就会内存无法访问。所以就产生了句柄表，句柄表是<code>0</code>环<code>EPROCESS</code>下的一个成员（蓝色的），句柄表存在的目的就是解决上面的问题。在句柄表里面会存储进程里面所有内核对象的地址（<code>0</code>环），所以将编号传回去，使用对应的内核对象时用编号来代替对应<code>0</code>环的地址。（相当于防火墙的存在，用户层没办法直接操作内核层）</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/gbb1.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>注意：</p>
<ul>
<li>多个进程可以共享一个内核对象，但是索引值可能不太一样。</li>
<li>有几个进程打开或使用了这个内核对象，内核对象中的计数器就会变为几（紫色里面的红色小下标）。</li>
<li><code>closehandle</code>的<code>api</code>是让内核对象中的计数器的值减一。</li>
<li>如果想要关闭线程的内核对象，要使计数器的值为<code>0</code>且需要关闭这个线程，两个条件缺一不可。除了线程以外的内核对象只需要使计数器的值为<code>0</code>就可以关闭这个内核对象。（创建对象计数器加一，打开对象加一，关闭对象减一）</li>
</ul>
<p><img src="https://c65mael.github.io/static/myassets-beg/gbb2.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>关于句柄和<code>ID</code>：</p>
<ul>
<li>都是系统分配的一个编号，句柄是客户程序使用<code>ID</code>主要是系统调度时使用。</li>
<li>调用<code>CloseHandle</code>关闭进程或者线程句柄的时候，只是让内核计数器减少一个，并不是终止进程或者线程。进程或线程将继续运行，直到它自己终止运行。</li>
<li>进程<code>ID</code>与线程<code>ID</code>是不可能相同。但不要通过进程或者线程的<code>ID</code>来操作进程或者线程，因为，这个编号是会重复使用的，也就是说，当你通过<code>ID=100</code>这个编号去访问一个进程的时候，它已经结束了，而且系统将这个编号赋给了另外一个进程或者线程。</li>
</ul>
</li>
</ul>
<h6>加密壳<span class="hx-absolute -hx-mt-20" id="加密壳"></span>
    <a href="#%e5%8a%a0%e5%af%86%e5%a3%b3" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>步骤：
<ol>
<li>
<p>读取主模块的数据</p>
</li>
<li>
<p>解密：得到原来的<code>PE</code>文件</p>
</li>
<li>
<p>以挂起的形式创建进程：<code>CreateProcess</code>，要创建的进程，就是壳子本身！</p>
</li>
<li>
<p>获取外壳程序的<code>Context</code>，后面要用</p>
</li>
<li>
<p>卸载外壳程序</p>
</li>
<li>
<p>在指定的位置分配空间：位置就是<code>src</code>的<code>ImageBase</code> 大小就是<code>Src</code>的<code>SizeOfImage</code></p>
</li>
<li>
<p>如果成功，将<code>Src</code>的<code>PE</code>文件拉伸，复制到该空间中；如果申请空间失败，但有重定位表：在任意位置申请空间，然后将<code>PE</code>文件拉伸、复制、修复重定位表</p>
</li>
<li>
<p>如果第6步申请空间失败，并且还没有重定位表，直接返回：失败</p>
</li>
<li>
<p>修改外壳程序的<code>Context</code>：</p>
<p>将<code>Context</code>的<code>ImageBase</code>改成<code>Src</code>的<code>ImageBase</code></p>
<p>将<code>Context</code>的<code>OPE</code>改成<code>Src</code>的<code>OEP</code></p>
</li>
<li>
<p>设置<code>Context</code>并恢复主线程</p>
</li>
<li>
<p>终止外壳程序，解壳过程结束</p>
</li>
</ol>
</li>
</ul>
<h6>鼠标_窗口<span class="hx-absolute -hx-mt-20" id="鼠标_窗口"></span>
    <a href="#%e9%bc%a0%e6%a0%87_%e7%aa%97%e5%8f%a3" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>查找指定窗口</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HWND hwnd <span style="color:#f92672">=</span> <span style="color:#f92672">::</span>FindWindow(NULL,TEXT(<span style="color:#e6db74">&#34;任务管理器&#34;</span>));</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>窗口控制</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//切换窗口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SwitchToThisWindow(hwnd,false);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//关闭窗口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">::</span>SendMessage(hwnd,WM_CLOSE,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>查找子窗口</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HWND hEdit <span style="color:#f92672">=</span> FindWindowEx(hwnd,NULL,<span style="color:#e6db74">&#34;Edit&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>HWND hEdit <span style="color:#f92672">=::</span>GetDlgItem(hwnd,<span style="color:#ae81ff">0x3E9</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>隐藏控制台</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//vs中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#pragma   comment(linker,&#34;/subsystem:\&#34;windows\&#34;  /entry:\&#34;mainCRTStartup\&#34;&#34;   ) 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//mingw中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ShowWindow(GetConsoleWindow(), SW_HIDE);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>模拟鼠标单击</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#f92672">::</span>GetWindowRect(hButton,<span style="color:#f92672">&amp;</span>r);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//设置鼠标的位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">::</span>SetCursorPos(r.left<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>,r.top<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//鼠标左键单击
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mouse_event(MOUSEEVENTF_LEFTDOWN,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);<span style="color:#75715e">//点下左键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mouse_event(MOUSEEVENTF_LEFTUP,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);<span style="color:#75715e">//松开左键
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>模拟键盘点击</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">0</span>,KEYEVENTF_KEYUP,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>Sleep(<span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">66</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">66</span>,<span style="color:#ae81ff">0</span>,KEYEVENTF_KEYUP,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>Sleep(<span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">67</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">67</span>,<span style="color:#ae81ff">0</span>,KEYEVENTF_KEYUP,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>keybd_event(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">0</span>,KEYEVENTF_KEYUP,<span style="color:#ae81ff">0</span>);</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p><a href="https://learn.microsoft.com/zh-cn/windows/win32/inputdev/virtual-key-codes" target="_blank" rel="noopener">键盘键与虚拟键码对照表</a></p>
</li>
</ul>
<h6>远程线程注入<span class="hx-absolute -hx-mt-20" id="远程线程注入"></span>
    <a href="#%e8%bf%9c%e7%a8%8b%e7%ba%bf%e7%a8%8b%e6%b3%a8%e5%85%a5" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>将自己的模块放到别人的进程中。</p>
<ul>
<li>
<p>如果想在进程（待注入）中执行代码，该如何实现呢？</p>
<p>创建线程：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE WINAPI <span style="color:#a6e22e">CreateThread</span>(
</span></span><span style="display:flex;"><span>    LPSECURITY_ATTRIBUTES lpThreadAttributes,
</span></span><span style="display:flex;"><span>    SIZE_T dwStackSize,
</span></span><span style="display:flex;"><span>    LPTHREAD_START_ROUTINE lpStartAddress,
</span></span><span style="display:flex;"><span>    LPVOID lpParameter,
</span></span><span style="display:flex;"><span>    DWORD dwCreationFlags,
</span></span><span style="display:flex;"><span>    PDWORD lpThreadId
</span></span><span style="display:flex;"><span>    );</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>创建远程线程：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HANDLE WINAPI <span style="color:#a6e22e">CreateRemoteThread</span>(
</span></span><span style="display:flex;"><span>    HANDLE hProcess,
</span></span><span style="display:flex;"><span>    LPSECURITY_ATTRIBUTES lpThreadAttributes,
</span></span><span style="display:flex;"><span>    SIZE_T dwStackSize,
</span></span><span style="display:flex;"><span>    LPTHREAD_START_ROUTINE lpStartAddress,
</span></span><span style="display:flex;"><span>    LPVOID lpParameter,
</span></span><span style="display:flex;"><span>    DWORD dwCreationFlags,
</span></span><span style="display:flex;"><span>    LPDWORD lpThreadId
</span></span><span style="display:flex;"><span>    );</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>创建远程线程时，需要指定进程<code>ID</code>/线程函数/线程函数的参数</p>
<ol>
<li><code>PID</code>的获取</li>
<li>线程函数的地址</li>
</ol>
</li>
<li>
<p>等待线程函数结束， 获取线程退出码，即<code>LoadLibrary</code>的返回值，即<code>dll</code>的首地址</p>
</li>
<li>
<p>释放为<code>DLL</code>名字申请的空间</p>
</li>
<li>
<p>关闭句柄</p>
</li>
<li>
<p>如何启动我们想在进程中执行的代码？</p>
</li>
</ul>
<h6>内存写入<span class="hx-absolute -hx-mt-20" id="内存写入"></span>
    <a href="#%e5%86%85%e5%ad%98%e5%86%99%e5%85%a5" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>步骤：</p>
<ol>
<li>获取自身句柄</li>
<li>得到<code>ImageSize</code>的大小，得到模块的<code>ImageBuffer</code></li>
<li>在当前空间申请空间存放自身代码</li>
<li>拷贝自身到缓存</li>
<li>打开要注入的进程</li>
<li>在远程进程申请空间</li>
<li>对模块中的代码进行重定位</li>
<li>得到模块中要运行的函数的地址</li>
<li>将模块在进程中的地址作为参数传递给入口函数</li>
<li>将修正后的模块，通过<code>WriteProcessMemory</code>写入远程进程的内存空间中</li>
<li>通过<code>CreateRemoteThread</code>启动刚写入的代码</li>
<li>释放内存</li>
</ol>
<p>模块入口函数执行：</p>
<ol>
<li>根据重定位信息，修复<code>IAT</code>表</li>
<li>执行其他功能</li>
<li>通过全局变量来结束这个函数</li>
</ol>
</li>
<li>
<p>思路：</p>
<ol>
<li>获取自身句柄</li>
<li>得到自己的<code>ImageBase/SizeOfImage</code></li>
<li>创建一个新的缓冲区，将自己复制进去</li>
<li>打开要注入的进程</li>
<li>在要注入的进程中申请内存，大小就是<code>SizeOfImage</code></li>
<li>修复自己进程的重定位表</li>
<li>将修复后的数据，复制到要注入的内存中</li>
<li>创建一个远程线程，执行<code>Entry</code></li>
</ol>
</li>
</ul>
<h6>IAT Hook<span class="hx-absolute -hx-mt-20" id="iat-hook"></span>
    <a href="#iat-hook" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>之前在<code>PE</code>结构中的<code>IAT</code>表（<code>call</code>后面的地址），就是修改<code>IAT</code>表里面的值实现<code>Hook</code></p>
<ul>
<li></li>
</ul>
<h6>Inline Hook<span class="hx-absolute -hx-mt-20" id="inline-hook"></span>
    <a href="#inline-hook" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><p>其实就是将正常的程序里面修改<code>5</code>字节改为<code>Jmp addr</code>，执行之后再跳回来，需要注意以下：</p>
<ul>
<li>细节：
<ol>
<li>在<code>Jmp</code>到自己的代码后要先保存所有的寄存器的值（<code>pushad pushfd</code>），在执行完成自己的代码后需要恢复所有的寄存器（<code>popad popfd</code>）</li>
<li>在恢复所有的寄存器之后需要执行修改的那<code>5</code>字节的指令，跳转回去则是跳转到修改5字节指令的下一行指令的位置</li>
</ol>
</li>
</ul>
<h3>硬编码<span class="hx-absolute -hx-mt-20" id="硬编码"></span>
    <a href="#%e7%a1%ac%e7%bc%96%e7%a0%81" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><h6>经典定长指令（修改寄存器）<span class="hx-absolute -hx-mt-20" id="经典定长指令修改寄存器"></span>
    <a href="#%e7%bb%8f%e5%85%b8%e5%ae%9a%e9%95%bf%e6%8c%87%e4%bb%a4%e4%bf%ae%e6%94%b9%e5%af%84%e5%ad%98%e5%99%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>汇编语言格式：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm1.png" alt="image" loading="lazy" /></p>
<p>每一条指令，最短1字节，最长15字节</p>
</li>
<li>
<p>背诵：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>鹌鹑蛋别生病，上帝
四零加减一，五零入出栈，九零俺交换
b零移动十六与三二</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>经典定长指令下(修改EIP)<span class="hx-absolute -hx-mt-20" id="经典定长指令下修改eip"></span>
    <a href="#%e7%bb%8f%e5%85%b8%e5%ae%9a%e9%95%bf%e6%8c%87%e4%bb%a4%e4%b8%8b%e4%bf%ae%e6%94%b9eip" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>条件跳转，后跟一个字节立即数的偏移（有符号），共两个字节。</p>
<p>如果条件成立，跳转到：<code>当前指令地址 + 当前指令长度 + Ib</code></p>
<p>最大值：向前跳<code>7f</code>，向后跳<code>80</code></p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x70</span>  	<span style="color:#66d9ef">JO</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x71</span>	<span style="color:#66d9ef">JNO</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x72</span>	<span style="color:#66d9ef">JB</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNAE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JC</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x73</span>	<span style="color:#66d9ef">JNB</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JAE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNC</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x74</span>	<span style="color:#66d9ef">JZ</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x75</span>	<span style="color:#66d9ef">JNZ</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x76</span>	<span style="color:#66d9ef">JBE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNA</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x77</span>	<span style="color:#66d9ef">JNBE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JA</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x78</span>	<span style="color:#66d9ef">JS</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x79</span>	<span style="color:#66d9ef">JNS</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x7A</span>	<span style="color:#66d9ef">JP</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JPE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x7B</span>	<span style="color:#66d9ef">JNP</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JPO</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x7C</span>	<span style="color:#66d9ef">JL</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNGE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x7D</span>	<span style="color:#66d9ef">JNL</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JGE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x7E</span>	<span style="color:#66d9ef">JLE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNG</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x7F</span>	<span style="color:#66d9ef">JNLE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JG</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>哦，不知被谁骗了了</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>条件跳转，后跟四个字节立即数的偏移（有符号），共五个字节。</p>
<p>如果条件成立，跳转到：<code>当前指令地址 + 当前指令长度 + Id</code></p>
<p>最大值：向前跳<code>7FFFFFFFF</code>，向后跳<code>80000000</code></p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x80</span>  		<span style="color:#66d9ef">JO</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x81</span>		<span style="color:#66d9ef">JNO</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x82</span>		<span style="color:#66d9ef">JB</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNAE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JC</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x83</span>		<span style="color:#66d9ef">JNB</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JAE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNC</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x84</span>		<span style="color:#66d9ef">JZ</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x85</span>		<span style="color:#66d9ef">JNZ</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x86</span>		<span style="color:#66d9ef">JBE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNA</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x87</span>		<span style="color:#66d9ef">JNBE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JA</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x88</span>		<span style="color:#66d9ef">JS</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x89</span>		<span style="color:#66d9ef">JNS</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x8A</span>		<span style="color:#66d9ef">JP</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JPE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x8B</span>		<span style="color:#66d9ef">JNP</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JPO</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x8C</span>		<span style="color:#66d9ef">JL</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNGE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x8D</span>		<span style="color:#66d9ef">JNL</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JGE</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x8E</span>		<span style="color:#66d9ef">JLE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JNG</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0F</span> <span style="color:#ae81ff">0x8F</span>		<span style="color:#66d9ef">JNLE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">JG</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>其他指令</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xE0</span>  	<span style="color:#66d9ef">LOOPNE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">LOOPNZ</span> <span style="color:#66d9ef">Ib</span> (<span style="color:#66d9ef">Jb</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">XE1</span>    <span style="color:#66d9ef">LOOPE</span><span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">LOOPZ</span> <span style="color:#66d9ef">Ib</span> (<span style="color:#66d9ef">Jb</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">XE2</span>	<span style="color:#66d9ef">LOOP</span> <span style="color:#66d9ef">Ib</span> (<span style="color:#66d9ef">Jb</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">XE3</span>	<span style="color:#66d9ef">JrCXZ</span> <span style="color:#66d9ef">Ib</span> (<span style="color:#66d9ef">Jb</span>) (<span style="color:#960050;background-color:#1e0010">在</span><span style="color:#ae81ff">32</span><span style="color:#960050;background-color:#1e0010">位模式中</span>,<span style="color:#66d9ef">RCX为ECX</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xE8</span>	<span style="color:#66d9ef">CALL</span> <span style="color:#66d9ef">Id</span> (<span style="color:#66d9ef">Jd</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xE9</span>	<span style="color:#66d9ef">JMP</span> <span style="color:#66d9ef">Id</span> (<span style="color:#66d9ef">Jd</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xEA</span>	<span style="color:#66d9ef">JMP</span> <span style="color:#66d9ef">Ap</span> <span style="color:#960050;background-color:#1e0010">（</span><span style="color:#66d9ef">Ap</span><span style="color:#960050;background-color:#1e0010">：六字节长度的直接地址）（</span><span style="color:#66d9ef">Jmp</span> <span style="color:#66d9ef">far</span><span style="color:#960050;background-color:#1e0010">）</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xEB</span>	<span style="color:#66d9ef">JMP</span> <span style="color:#66d9ef">Ib</span> (<span style="color:#66d9ef">Jb</span>)<span style="color:#960050;background-color:#1e0010">（</span><span style="color:#66d9ef">Jmp</span> <span style="color:#66d9ef">short</span><span style="color:#960050;background-color:#1e0010">）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xC3</span> 	<span style="color:#66d9ef">RET</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xC2</span>	<span style="color:#66d9ef">RET</span> <span style="color:#66d9ef">Iw</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">XCB</span>	<span style="color:#66d9ef">RETF</span> <span style="color:#960050;background-color:#1e0010">（</span><span style="color:#66d9ef">return</span> <span style="color:#66d9ef">far</span><span style="color:#960050;background-color:#1e0010">）</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">xCA</span>	<span style="color:#66d9ef">RETF</span> <span style="color:#66d9ef">Iw</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
<h6>经典变长指令（_ModR/M）<span class="hx-absolute -hx-mt-20" id="经典变长指令_modrm"></span>
    <a href="#%e7%bb%8f%e5%85%b8%e5%8f%98%e9%95%bf%e6%8c%87%e4%bb%a4_modrm" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>先研究一下的指令格式：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#ae81ff">0x88</span>  	MOV Eb, Gb			G<span style="color:#960050;background-color:#1e0010">：通用寄存器</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x89</span>	MOV Ev, Gv			E<span style="color:#960050;background-color:#1e0010">：寄存器</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">内存</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x8A</span>	MOV Gb, Eb			b<span style="color:#960050;background-color:#1e0010">：字节</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x8B</span>	MOV Gv, Ev			v<span style="color:#960050;background-color:#1e0010">：</span>Word, doubleword or quadword</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p>当指令中出现内存操作对象的时候，就需要在操作码后面附加一个字节来进行补充说明，这个字节被称为<code>ModR/M</code>。</p>
<p>该字节的<code>8</code>个位被分成了三部分：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>7        6 5             3 2     0
__________________________________
|   Mod   |  Reg/Opcode   | R/M  |
|_________|_______________|______|</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>其中，<code>Reg/Opcode</code>（第<code>3、4、5</code>位，共<code>3</code>个字节）描述指令中的<code>G</code>部分，即寄存器。</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">寄存器宽度</th>
          <th style="text-align: center">000</th>
          <th style="text-align: center">001</th>
          <th style="text-align: center">010</th>
          <th style="text-align: center">011</th>
          <th style="text-align: center">100</th>
          <th style="text-align: center">101</th>
          <th style="text-align: center">110</th>
          <th style="text-align: center">111</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">32</td>
          <td style="text-align: center">EAX</td>
          <td style="text-align: center">ECX</td>
          <td style="text-align: center">EDX</td>
          <td style="text-align: center">EBX</td>
          <td style="text-align: center">ESP</td>
          <td style="text-align: center">EBP</td>
          <td style="text-align: center">ESI</td>
          <td style="text-align: center">EDI</td>
      </tr>
      <tr>
          <td style="text-align: center">8</td>
          <td style="text-align: center">AL</td>
          <td style="text-align: center">CL</td>
          <td style="text-align: center">DL</td>
          <td style="text-align: center">BL</td>
          <td style="text-align: center">AH</td>
          <td style="text-align: center">CH</td>
          <td style="text-align: center">DH</td>
          <td style="text-align: center">BH</td>
      </tr>
  </tbody>
</table>
<p><code>Mod</code>（第<code>6、7</code>位）和<code>R/M</code>（第<code>0、1、2</code>位）共同描述指令中的<code>E</code>部分，即寄存器/内存。</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm2.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>实例：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm2-1.png" alt="image" loading="lazy" /></p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm2-2.png" alt="image" loading="lazy" /></p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm2-3.png" alt="image" loading="lazy" /></p>
<p>当<code>Mod = 11</code>时，<code>ModR/M</code>字节直接操作两个寄存器：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm2-4.png" alt="image" loading="lazy" /></p>
<p>比如来拆一个：<code>0x88 0x10</code></p>
<ol>
<li>首先确定是<code>MOV Eb, Gb</code>格式</li>
<li>其次<code>0x10 = 0001 0000 = 00 010 000</code></li>
<li>查表<code>Mod = 00 R/M = 000</code>格式为<code>MOV [EAX], Gb</code></li>
<li>因为<code>Reg/Opcode = 010</code>格式为<code>MOV [EAX], dl</code></li>
</ol>
</li>
<li>
<p>总结：</p>
<ol>
<li><code>ESP</code>指向栈顶，是浮动的，不确定的，英特尔将这个编码废弃，由另外的格式来说明。</li>
<li><code>EBP</code>指向栈底，而<code>[EBP]</code>通常存储上一个<code>EBP</code>，所以<code>[EBP]</code>无数据操作意义，英特尔将这个编码废弃，改为立即数寻址。</li>
<li>其实这次的指令的源操作数与目标操作数都是一个<code>E</code>，一个<code>G</code>。<code>Reg/Opcode</code>是确定<code>G</code>的，<code>Mod</code>与<code>R/M</code>是确定<code>E</code>的。再看它的指令是<code>b</code>（字节）还是<code>v</code>（<code>Word</code>）（这一步是由机器码确定的<code>0x88</code>就是<code>8</code>位的）。之后再看<code>Mod</code>部分来确定<code>E</code>是寄存器还是内存。</li>
</ol>
</li>
</ul>
<h6>经典变长指令（_SIB字段）<span class="hx-absolute -hx-mt-20" id="经典变长指令_sib字段"></span>
    <a href="#%e7%bb%8f%e5%85%b8%e5%8f%98%e9%95%bf%e6%8c%87%e4%bb%a4_sib%e5%ad%97%e6%ae%b5" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p><code>ModR/M</code>字段是用来进行内存寻址的，可当地址形如<code>DS:[EAX + ECX*2 + 12345678]</code>时，仅仅靠<code>ModR/M</code>字段，是描述不出来的。这时就在<code>ModR/M</code>后面增加一个<code>SIB</code>字节，与<code>ModR/M</code>字段共同描述。</p>
<p>在<code>ModR/M</code>字节后，还紧跟着一个<code>SIB</code>字节。<code>SIB</code>字节的<code>8</code>个位被分成了三部分：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>7          6 5        3 2      0
________________________________
|   Scale   |  Index   | Base  |
|___________|__________|_______|</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>在例子<code>DS:[EAX + ECX*2 + 12345678]</code>中，<code>Scale</code>描述<code>2^1</code>，<code>Index</code>描述<code>ECX</code>，<code>Base</code>描述<code>EAX</code>，而<code>12345678</code>由<code>ModR/M</code>字段决定。所以<code>SIB</code>字段描述的方式为：<code>Base + Index*2Scale (Scale描述2Scale，所以只能为 *1 *2 *4 *8)</code></p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm3.png" alt="image" loading="lazy" /></p>
</li>
<li>
<p>实例：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm3-1.png" alt="image" loading="lazy" /></p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm3-2.png" alt="image" loading="lazy" /></p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm3-3.png" alt="image" loading="lazy" /></p>
<p>这个<code>[*]</code>在特定情况下会变化，在上面这个例子中是一个<code>32</code>位的偏移。其他的情况：</p>
<ul>
<li>
<p>如果<code>MOD</code>为<code>00</code>，则<code>[*]</code>命名法表示<code>disp32</code>没有基数。否则，<code>[*]</code>表示<code>disp8</code>或<code>disp32+[EBP]</code>。这提供了以下地址模式：
<code>MOD</code>位有效地址</p>
<p><code>00</code>：<code>[scaled index] + disp32</code>
<code>01</code>：<code>[scaled index] + disp8 + [EBP]</code>
<code>10</code>：<code>[scaled index] + disp32 + [EBP]</code></p>
</li>
</ul>
</li>
</ul>
<h6>经典变长指令（_Reg/Opcode）<span class="hx-absolute -hx-mt-20" id="经典变长指令_regopcode"></span>
    <a href="#%e7%bb%8f%e5%85%b8%e5%8f%98%e9%95%bf%e6%8c%87%e4%bb%a4_regopcode" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>之前的<code>Mod</code>与<code>R/M</code>之间的<code>Reg/Opcode</code>都是当作寄存器来分析的，但是它还可以标识<code>Opcode</code></p>
</li>
<li>
<p>实例：</p>
<p><img src="https://c65mael.github.io/static/myassets-beg/ybm4.png" alt="image" loading="lazy" /></p>
<p>大概就是这样找的了</p>
</li>
</ul>
<h6>指令前缀<span class="hx-absolute -hx-mt-20" id="指令前缀"></span>
    <a href="#%e6%8c%87%e4%bb%a4%e5%89%8d%e7%bc%80" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ul>
<li>
<p>段寄存器（后面会很重要）</p>
<p>段寄存器的作用：早期<code>8086cpu</code>寻址范围小，英特尔遍通过段寄存器来拓展内存，即通过<code>段寄存器基址+偏移</code>的方式来寻址。</p>
<p><code>[]</code>中的地址为有效地址（<code>Effect Address</code>），<code>有效地址+段寄存器基址</code>才是实际地址<code>LA</code>（线性地址<code>Line Address</code>）。</p>
<p><strong>段寄存器本身并不是存储数据的，它里面存储的是一个地址</strong>。  这个地址指向了内存中某个段的 <strong>起始位置</strong>。（微机原理有讲过）</p>
<p><code>线性地址 = 段基址 + 有效地址</code></p>
<p>在后来的<code>80386</code>时，<code>cpu</code>的寻址范围大大提升，这些段寄存器便被用作了其他用途。但是<code>DS:[]</code>类似这种寻址格式却被保留了下来。</p>
<p>实际上操作码已经决定了寻址时使用哪个段寄存器作为基址，不需要其他字节描述。规则如下：</p>
<ol>
<li>如果没有特别说明，<code>[]</code>前为<code>DS</code>，即<code>DS:[]</code></li>
<li><code>PUSH POP</code>指令，以及在<code>[]</code>中使用<code>ESP/EBP</code>的，使用<code>SS</code>段</li>
<li>在<code>[Base + Index*2Scale + I]</code>中，以<code>Base</code>为判断条件，没有特别说明，用<code>DS</code>。如果<code>Base</code>为<code>ESP/EBP</code>，则用<code>SS</code>段</li>
<li>串操作指令一般使用<code>ES</code>。<code>MOV ES:[EDI] DS:[ESI]</code>中，目标<code>EDI</code>使用<code>ES</code>段，其他使用<code>DS</code>段</li>
<li><code>EIP</code>指向当前指令，<code>EIP</code>取指令时使用的是<code>CS</code>段</li>
<li>如果指令加段寄存器前缀，则该条指令一律用这个段，如果加多个段寄存器前缀，默认只看<code>op</code>前的那个</li>
</ol>
</li>
<li>
<p>操作指令前缀</p>
<ul>
<li>
<p><code>0x66</code>：将操作数改为<code>16</code>字节。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">50</span>		<span style="color:#a6e22e">PUSH</span> <span style="color:#66d9ef">EAX</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">66:50</span>	<span style="color:#a6e22e">PUSH</span> <span style="color:#66d9ef">AX</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
<li>
<p><code>0x67</code>：将操作数改为<code>16</code>字节。（修改默认寻址方式）</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">8801</span>          <span style="color:#a6e22e">MOV</span> <span style="color:#66d9ef">BYTE</span> <span style="color:#66d9ef">PTR</span> <span style="color:#66d9ef">DS</span>:[<span style="color:#66d9ef">ECX</span>],<span style="color:#66d9ef">AL</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">67:8801</span>       <span style="color:#a6e22e">MOV</span> <span style="color:#66d9ef">BYTE</span> <span style="color:#66d9ef">PTR</span> <span style="color:#66d9ef">DS</span>:[<span style="color:#66d9ef">BX</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">DI</span>],<span style="color:#66d9ef">AL</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</li>
</ul>
</li>
</ul>
<h6>总结<span class="hx-absolute -hx-mt-20" id="总结"></span>
    <a href="#%e6%80%bb%e7%bb%93" class="subheading-anchor" aria-label="Permalink for this section"></a></h6><ol>
<li>
<p>操作码决定后面有没有<code>ModR/M</code>字段和立即数</p>
</li>
<li>
<p><code>ModR/M</code>决定后面有没有<code>SIB</code>字节和偏移</p>
</li>
<li>
<p>操作指令中只要包含<code>Ev/Eb</code>，则指令中一定有<code>ModR/M</code>字节</p>
</li>
<li>
<p>只需要把操作码确定下来，那么后面有什么字段，就都能确定了。即一切由操作码决定。</p>
</li>
<li>
<p>操作码长度：</p>
<p>一个字节：<code>00 - FF</code>（<code>TableA-2</code>   <code>0F</code>除外）</p>
<p>两个字节：<code>0F 00 - 0F FF</code>（<code>TableA-3</code>）</p>
<p>三个字节：<code>0F 38 / 0F 3A</code> （<code>TableA-3</code> <code>TableA-4</code> <code>TableA-5</code>）</p>
</li>
</ol>

        </div>
        <div class="hx-mt-16"></div>
        <div class="hx-mb-8 hx-flex hx-items-center hx-border-t hx-pt-8 dark:hx-border-neutral-800 contrast-more:hx-border-neutral-400 dark:contrast-more:hx-border-neutral-400 print:hx-hidden"><a
        href="/docs/windows/windows-bas/"
        title="Windows BAS"
        class="hx-flex hx-max-w-[50%] hx-items-center hx-gap-1 hx-py-4 hx-text-base hx-font-medium hx-text-gray-600 hx-transition-colors [word-break:break-word] hover:hx-text-primary-600 dark:hx-text-gray-300 md:hx-text-lg ltr:hx-pr-4 rtl:hx-pl-4"
      ><svg class="hx-inline hx-h-5 hx-shrink-0 ltr:hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>Windows BAS</a><a
        href="/docs/windows/windows-ext/"
        title="Windows EXT"
        class="hx-flex hx-max-w-[50%] hx-items-center hx-gap-1 hx-py-4 hx-text-base hx-font-medium hx-text-gray-600 hx-transition-colors [word-break:break-word] hover:hx-text-primary-600 dark:hx-text-gray-300 md:hx-text-lg ltr:hx-ml-auto ltr:hx-pl-4 ltr:hx-text-right rtl:hx-mr-auto rtl:hx-pr-4 rtl:hx-text-left"
      >Windows EXT<svg class="hx-inline hx-h-5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></a></div>
        
      </main>
    </article>
  </div>

      <footer class="hextra-footer hx-bg-gray-100 hx-pb-[env(safe-area-inset-bottom)] dark:hx-bg-neutral-900 print:hx-bg-transparent"><div
      class="hextra-custom-footer hx-max-w-screen-xl hx-pl-[max(env(safe-area-inset-left),1.5rem)] hx-pr-[max(env(safe-area-inset-right),1.5rem)] hx-text-gray-600 dark:hx-text-gray-400"
    ></div><div
        class="hx-max-w-screen-xl hx-mx-auto hx-flex hx-justify-center hx-py-12 hx-pl-[max(env(safe-area-inset-left),1.5rem)] hx-pr-[max(env(safe-area-inset-right),1.5rem)] hx-text-gray-600 dark:hx-text-gray-400 md:hx-justify-start"
      >
        <div class="hx-flex hx-w-full hx-flex-col hx-items-center sm:hx-items-start"><div class="hx-font-semibold"><a class="hx-flex hx-text-sm hx-items-center hx-gap-1 hx-text-current" target="_blank" rel="noopener noreferrer" title="Hextra GitHub Homepage" href="https://github.com/imfing/hextra">
    <span>Powered by Hextra<svg height=1em class="hx-inline-block ltr:hx-ml-1 rtl:hx-mr-1 hx-align-[-2.5px]" viewBox="0 0 180 180" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="m 105.50024,22.224647 c -9.59169,-5.537563 -21.40871,-5.537563 -31.000093,0 L 39.054693,42.689119 C 29.463353,48.226675 23.55484,58.460531 23.55484,69.535642 v 40.928918 c 0,11.07542 5.908513,21.3092 15.499853,26.84652 l 35.445453,20.46446 c 9.591313,5.53732 21.408404,5.53732 31.000094,0 l 35.44507,-20.46446 c 9.59131,-5.53732 15.49985,-15.7711 15.49985,-26.84652 V 69.535642 c 0,-11.075111 -5.90854,-21.308967 -15.49985,-26.846523 z M 34.112797,85.737639 c -1.384445,2.397827 -1.384445,5.352099 0,7.749927 l 24.781554,42.922974 c 1.38437,2.39783 3.942853,3.87496 6.711592,3.87496 h 49.563107 c 2.76905,0 5.3273,-1.47713 6.71144,-3.87496 l 24.78194,-42.922974 c 1.38414,-2.397828 1.38414,-5.3521 0,-7.749927 L 121.88049,42.814746 c -1.38414,-2.397828 -3.94239,-3.874964 -6.71144,-3.874964 H 65.605944 c -2.768739,0 -5.327223,1.477059 -6.711592,3.874964 z" style="stroke-width:0.774993" /></svg></span>
  </a></div></div>
      </div></footer>
    
    <script defer src="/js/main.js" integrity=""></script>
<script defer src="/lib/flexsearch/flexsearch.bundle.min.0425860527cc9968f9f049421c7a56b39327d475e2e3a8f550416be3a9134327.js" integrity="sha256-BCWGBSfMmWj58ElCHHpWs5Mn1HXi46j1UEFr46kTQyc="></script>
    <script defer src="/en.search.js" integrity=""></script><script defer src="/lib/mermaid/mermaid.min.0d2b6f2361e7e0ce466a6ed458e03daa5584b42ef6926c3beb62eb64670ca261.js" integrity="sha256-DStvI2Hn4M5Gam7UWOA9qlWEtC72kmw762LrZGcMomE="></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    
    document.querySelectorAll(".mermaid").forEach(el => {
      el.dataset.original = el.innerHTML;
    });

    const theme = document.documentElement.classList.contains("dark") ? "dark" : "default";
    mermaid.initialize({ startOnLoad: true, theme: theme });

    let timeout;
    new MutationObserver(() => {
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        const theme = document.documentElement.classList.contains("dark") ? "dark" : "default";
        document.querySelectorAll(".mermaid").forEach(el => {
          
          el.innerHTML = el.dataset.original;
          el.removeAttribute("data-processed");
        });
        mermaid.initialize({ startOnLoad: true, theme: theme });
        mermaid.init();
      }, 150);
    }).observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["class"]
    });
  });
</script>

  </body>
</html>
